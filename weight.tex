\section{Свойства весовой функции}

\begin{lm}
\label{weightSum}
Рассмотрим непрерывную функцию $a \ge 0$, заданную на $[-1,1]$ и для произвольных $s \le t \in [-1,1]$
удовлетворяющую условию
\begin{equation}
\label{almostConcave}
a( s ) + a ( t ) \ge a( 1 - t + s ).
\end{equation}
Тогда для любых $-1 \le t_1 \le t_2 \le \ldots \le t_n \le 1$ верно
\begin{align*}
\sum_{k=1}^n a(t_k) & \ge a( 1 - \sum_{k = 1}^n (-1)^k t_k ), & \text{ для четных $n$},&\\
\sum_{k=1}^n a(t_k) & \ge a( -\sum_{k = 1}^n (-1)^k t_k ),    & \text{ для нечетных $n$}.&
\end{align*}
\end{lm}

\begin{proof}
Будем доказывать по индукции. Для $n = 1$ утверждение тривиально.
Пусть теперь $n$ четное. Тогда, по предположению индукции,
$\sum_{k=1}^{n - 1} a(t_k) \ge a( -\sum_{k = 1}^{n - 1} (-1)^k t_k )$. Значит
$$\sum_{k = 1}^{n - 1} a( t_k ) + a( t_n ) \ge a( -\sum_{k = 1}^{n - 1} (-1)^k t_k ) + a( t_n ) \ge
a( 1 - \sum_{k = 1}^{n} (-1)^k t_k ).$$
В случае нечетного $n$ воспользуемся предположением индукции в следующем виде:
$\sum_{k=2}^n a(t_k) \ge a( 1 + \sum_{k = 2}^n (-1)^k t_k )$. Тогда
$$a( t_1 ) + \sum_{k = 2}^{n - 1} a( t_k ) \ge a( t_1 ) + a( 1 + \sum_{k = 2}^{n} (-1)^k t_k ) \ge
a( -\sum_{k = 2}^{n} (-1)^k t_k + t_1 ) = a( -\sum_{k = 1}^{n} (-1)^k t_k ).$$
\end{proof}

\rem Если вдобавок к условию леммы предположить, что функция $a$ четна, то выполняются также следующие неравенства:
\begin{align*}
\sum_{k=1}^n a(t_k) & \ge a( -1 + \sum_{k = 1}^n (-1)^k t_k ), & \text{ для четных $n$},&\\
\sum_{k=1}^n a(t_k) & \ge a( \sum_{k = 1}^n (-1)^k t_k ),    & \text{ для нечетных $n$}.&
\end{align*}

\rem Для четной функции $a$ условие (\ref{almostConcave}) можно переписать в следующем виде: для любых $s,t \in [-1,1]$ таких, что
$1 + s + t \le 1$ верно 
\begin{equation}
\label{almostConcaveSum}
a( s ) + a( t ) \ge a( 1 + s + t ).
\end{equation}

\begin{lm}
Если четная функция $a$ удовлетворяет условию (\ref{almostConcaveSum}), а также найдется такое $x_0 > -1$, что
$a(x_0) = 0$, то $a(-1) = 0$ и функция $a$ имеет период $x_0+1$. В частности, для любого неотрицательного
целого $k$ такого, что $-1 + k (x_0 + 1) \le 1$, выполнено $a(-1 + k (x_0 + 1)) = 0$.
\end{lm}

\begin{proof}
Возьмем в условии (\ref{almostConcaveSum}) $s = x_0$, $t = -x_0$. Тогда
$a(s) + a(t) = 0 \ge a(1 + s + t) = a(1) \ge 0$. Значит $a(-1) = a(1) = 0$.
Возьмем некоторое $x \in [-1,1]$ и докажем, что $a(x) = a( x + (1 + x_0) )$ при условии, что $1 + x + x_0 <= 1$.
В условии (\ref{almostConcaveSum}) положим $s = x_0$, $t = x$. Тогда $a(x) \ge a( x + (1 + x_0) )$.
Теперь положим $s = x_0$, $t = -x - (1 + x_0)$. Тогда $a(t) = a(x + (1 + x_0)) \ge a(-x) = a(x)$. Значит
$a(x) = a( x + (1 + x_0) )$.
\end{proof}

\begin{lm}
\label{piecewiseLinearConcave}
Пусть функция $a$ удовлетворяет неравенству (\ref{almostConcaveSum}), $k \in \Nat$.
Тогда кусочно-линейная функция $a_k$, построенная на точках
$(-1 + \frac{2i}{k}, a(-1 + \frac{2i}{k}))$ при $i = 0, 1, \dots, k$, тоже
удовлетворяет (\ref{almostConcaveSum}).
\end{lm}
\begin{proof}
Пусть $s = -1 + \frac{2i}{k}$, $t = -1 + \frac{2j}{k}$. Тогда неравенство
выполняется для $a_k$, потому что оно выполняется для $a$. Пусть теперь для
некоторого $s = -1 + \frac{2i}{k}$ и некоторого
$t \in [-1 + \frac{2j}{k}, -1 + \frac{2(j + 1)}{k}]$
$a_k(s) + a_k(t) < a_k( 1 + s + t )$. Рассмотрим линейную функцию
$h(t) = a_k( 1 + s + t ) - a_k(t) - a_k(s)$.
$h(-1 + \frac{2j}{k}) \le 0$, $h(t) > 0$, значит
$h(-1 + \frac{2(j + 1)}{k}) > 0$, что противоречит уже доказанному.
Тем самым, неравенство выполняется для любого $s \in -1 + \frac{2i}{k}$
и $t \in [-1, 1]$. Аналогично, заведя линейную функцию
$g(s) = a_k( 1 + s + t ) - a_k(t) - a_k(s)$ для произвольного
фиксированного $t \in [-1, 1]$, и предположив, что $g(s) > 0$ для некоторого
$s \in [-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}]$, придем к противоречию
и получим неравенство для любых $s$ и $t$.
\end{proof}

\begin{lm}
\label{maxConcave}
Пусть функции $a_1$ и $a_2$ удовлетворяют неравенству (\ref{almostConcaveSum}),
тогда функция $a(x) = \max (a_1(x), a_2(x))$ тоже ему удовлетворяет.
\end{lm}
\begin{proof}
$a(1 + s + t ) = \max( a_1(1 + s + t), a_2(1 + s + t) ) \le
\max( a_1( s ) + a_1( t ), a_2( s ) + a_2( t ) ) \le
\max( a_1( s ), a_2( s ) ) + \max( a_1( t ), a_2( t ) ) =
a( s ) + a( t ).$
\end{proof}

Рассмотрим кусочно монотонную функцию $a$. Возьмем некоторое число $\gamma > 0$
и заменим функцию $a$ в окрестностях ненулевых минимумов на константу так, чтобы
новая функция $a_\gamma$ оставалась непрерывной и значение в каждом из минимумов
поднялось на $\gamma$. Очевидно, при достаточно малой длине отрезков постоянства,
а значит, и при достаточно малом $\gamma$, функция $a_\gamma$ определена.
Видно, что монотонность в каждой точке сохраняется, становясь в окрестностях
ненулевых минимумов нестрогой, что даст нам в дальнейшем свободу выбора
границ участков монотонности.

\begin{lm}
\label{flattenMin}
Пусть функция $a$ кусочно монотонна и удовлетворяет неравенству (\ref{almostConcaveSum}),
тогда найдется число $\gamma_0 > 0$ такое, что при любом $\gamma \le \gamma_0$
функция $a_\gamma$ удовлетворяет неравенству (\ref{almostConcaveSum}).
\end{lm}
\begin{proof}
Введем обозначение для множества нулей функции $a$: $Z = a^{-1}(0)$ и для
множества локальных строгих ненулевых минимумов функции $a$ за исключением
крайних точек отрезка
$M = \{ x \in ( -1, 1 ) \setminus Z: \exists \eps( x ) \forall y :
0 < \abs{ x - y } < \eps \ a( y ) > a( x ) \}$.
Докажем утверждение леммы от противного.
Пусть $\gamma_i \to 0$ и для каждого $i$ найдутся $s_i$ и $t_i$, что
$a_{\gamma_i}( s_i ) + a_{\gamma_i}( t_i) < a_{\gamma_i}( 1 + s_i + t_i )$.
Поскольку $( s_i, t_i )$ лежат в компакте, можно, перейдя к
подпоследовательности, получить $s_i \to s$ и $t_i \to t$.
Поскольку $a_{\gamma_i}( x ) \to a( x )$, в пределе получим
$a( s ) + a( t ) = a( 1 + s + t )$.
Докажем от противного, что $1 + s + t \in M$ (и, в частности,
$1 + s + t \in (-1, 1)$). Пусть $1 + s + t \notin M$. Тогда, начиная с
некоторого $i$, будет $a_{\gamma_i}( 1 + s_i + t_i ) = a( 1 + s_i + t_i ) \le
a( s_i ) + a( t_i ) \le a_{\gamma_i}( s_i ) + a_{\gamma_i}( t_i ) <
a_{\gamma_i}( 1 + s_i + t_i )$. Теперь докажем от противного, что
$s, t \in M \cup Z$. Пусть, например, $s \notin M \cup Z$. Тогда
найдется последовательность $\delta _i \to 0$, что
$a( s + \delta _i ) \le a( s )$. Но тогда $a( s + \delta _i ) + a( t )
\ge a( 1 + s + \delta _i + t ) > a( 1 + s + t ) = a( s ) + a( t ) \ge
a( s + \delta _i ) + a( t )$. Здесь $1 + s + \delta _i + t \in (-1, 1)$
начиная с некоторого $i$, так как $1 + s + t \in M$. По той же причине
выполняется второе неравенство.
Таким образом, $s, t \in M \cup Z, 1 + s + t \in M$.
Пусть $s, t \in Z$, тогда $1 + s + t \in Z$, но такого быть не может,
поэтому либо $s$, либо $t$ находится в $M$.
Если $s, t \in M$, получаем $( a( s ) + \gamma_i ) + ( a( t ) + \gamma_i ) =
a_{\gamma_i}( s_i ) + a_{\gamma_i}( t_i ) < a_{\gamma_i}( 1 + s_i + t_i ) =
a( 1 + s + t ) + \gamma_i$, то есть
$a( s ) + a( t ) < a( 1 + s + t )$. Если же, например, $s \in Z, t \in M$, то
$a( s ) + ( a( t ) + \gamma_i ) =
a_{\gamma_i}( s_i ) + a_{\gamma_i}( t_i ) < a_{\gamma_i}( 1 + s_i + t_i ) =
a( 1 + s + t ) + \gamma_i$, то есть опять же
$a( s ) + a( t ) < a( 1 + s + t )$
Тем самым, мы пришли к противоречию,
доказав для достаточно малых $\gamma$ $a_\gamma( s ) + a_\gamma( t ) \ge a_\gamma( 1 + s + t )$.
\end{proof}
