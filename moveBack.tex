\section{Получение результата в общем случае}

На протяжении всей работы мы накладываем на вес $a$ следующие ограничения:

\smallskip
\noindent
(H1) $a(x, u)$ удовлетворяет неравенству (\ref{almostConcaveSum}),
непрерывна, а также $I(u) < \infty$.
\smallskip

Будем называть такие функции допустимыми.

Далее будем накладывать по одному новые условия на вес $a$, каждый раз
показывая, что от нового условия можно избавиться, с тем, чтобы войти в
условия, при которых результат уже доказан.

Схема: $a$ удовлетворяет $H1$--$Hi$.
Строим последовательность $a_k$, удовлетворяющих $H1$--$H(i+1)$
так, чтобы $a^n := \max\limits_{k \le n} a_k$ тоже удовлетворяли
$H1$--$H(i+1)$ и выполнялось
\begin{align*}
F(u(x), a^n(x, u(x)) u'(x)) & \nearrow F(u(x), a(x, u(x)) u'(x))\\
F(u^*(x), a^n(x, u^*(x)) {u^*}'(x)) & \nearrow F(u^*(x), a(x, u^*(x)) {u^*}'(x))
\end{align*}
для почти всех $x$.

\begin{prop}
\label{levelDerivative}
\cite[стр. 137]{LL}
Для любой $u \in \W(-1, 1)$ и произвольного $u_0 \in \Real$ выполнено
$u'(x) = 0$ для почти всех $x \in \{ x : u(x) = u_0 \}$.
\end{prop}

\begin{lm}
\label{zeroApprox}
Предположим, вес $a$ является допустимым и имеется замкнутое множество
$W \subset \Real$ такое, что либо оно содержит счетное число элементов,
либо $a|_{u \in W} \equiv 0$.
Тогда найдется последовательность весов $b_k$ такая, что $I(b_k, u) \to I(a, u)$,
и для любого $u$ в некоторой окрестности $W$ (зависящей от $k$) $b_k(\cdot, u) \equiv 0$,
а также $b_k \nearrow a$ для всех $u$, кроме, возможно, счетного количества.
\end{lm}

\begin{proof}
Возьмем $b_k(x, u) := a(x, u) \min(1, \max(0, k \dist(u, W) - 1)) \le a(x, u)$.
Этот вес равен нулю в $\left(\frac{1}{k}\right)$-окрестности $W$.
В частности, если $W$ не состоит из счетного числа элементов,
$b_k \equiv a \equiv 0$ при $u \in W$.
Кроме того, $b_k \equiv a$ вне $\left(\frac{2}{k}\right)$-окрестности $W$ и
$b_k(x, u)$ возрастают при увеличении $k$.
Тем самым, $b_k \nearrow a$ при всех $u$ кроме, возможно, счетного количества точек.
Отсюда $I(\Real \setminus W, b_k, u) \nearrow I(\Real \setminus W, a, u)$.

Если $W$ не состоит из счетного числа точек,
$I(W, b_k, u) = \int_W F(u(x), 0) dx = I(W, a, u)$.
В противном случае
$W = \{w_i\}_{i = 1}^\infty$ и
$$I(W, b_k, u) = \sum_{i = 1}^\infty \int\limits_{x : u(x) = w_i} F(w_i, b_k(x, w_i) u'(x)) dx.$$
При этом, по утверждению (\ref{levelDerivative}), на каждом из множеств
$\{ x : u(x) = w_i \}$ производная $u'(x)$ почти всюду равна нулю.
То есть,
$I(W, b_k, u) = \sum_{i = 1}^\infty \int\limits_{x : u(x) = w_i} F(w_i, 0) dx = I(W, a, u)$
(такой интеграл не зависит от веса).
\end{proof}


\bigskip
$(H2)$ Количество нулей функций $a(\cdot, u)$ ограничено константой,
не зависящей от $u$ для тех $u \in [\min u(x), \max u(x)]$,
для которых $a(\cdot, u) \not\equiv 0$.

Предположим, вес $a$ является допустимым.
Будем строить приближение для него весами, удовлетворяющими $H1$--$H2$.
Воспользуемся леммой \ref{zeroApprox}.
В качестве множества $W$ возьмем $\{ u \in \Real: a(\cdot, u) \equiv 0 \}$.
Введем обозначение $Z_a(u) := \{ x \in [-1, 1]: a(x, u) = 0 \}$.
Заметим, что множества $Z_{b_k}(u)$ отличаются от $Z_a(u)$ лишь сменой для
некоторых $u$ на весь отрезок $[-1, 1]$.
Нам остается доказать, что полученные $b_k$ удовлетворяют $H2$,
то есть найдется число $p$ такое, что для каждого $u$ множество
$Z_{b_k}(u)$ либо совпадает с отрезком $[-1, 1]$, либо $\#Z_{b_k}(u) \le p$.

Предположим, это не так, и найдется последовательность $u_l$, для которой
$l < \#Z_{b_k}(u_l) < \infty$.
Тогда, после перехода к подпоследовательности, она будет стремиться к некоторому
$u_0$. Более того, $Z_{b_k}(u_l) = Z_a(u_l)$, поскольку $Z_{b_k}(u_l) \neq [-1, 1]$.
Покажем, что $Z_a(u_0) = [-1, 1]$. Из леммы \ref{periodicity} следует, что
множества $Z_a(u_l)$ периодические с периодом не более $\frac{2}{l - 1}$.
Возьмем некоторый $x \in [-1, 1]$. Для каждого $l$ найдется $x_l$ такой, что
$\abs{x - x_l} \le \frac{1}{l - 1}$ и $a(x_l, u_l) = 0$.
Но $a(x_l, u_l) \to a(x, u_0)$.
Тем самым, $a(x, u_0) = 0$ и $Z_a(u_0) = [-1, 1]$.
Но это означает, что для каждого $u$ такого,
что $\abs{u - u_0} \le \frac{1}{k}$, выполнено $b_k(\cdot, u) \equiv 0$,
что противоречит $\#Z_{b_k}(u_l) < \infty$.

\bigskip
Введем обозначение
$$D_k(a, U) := \sup\limits_{u \in U}
\frac{\max\limits_{ \abs{x_1 - x_2} \le \frac{2}{k} } \abs{a(x_1, u) - a(x_2, u)} }
{\min\limits_{x \in C_k(u)} a(x, u)},$$
где $C_k(u)$ --- $\frac{2}{k}$-окрестность множества $u^{-1}(u)$.
$U(a) := \{ u \in [\min u(x), \max u(x)]: a(\cdot, u) \not \equiv 0 \}$.


$(H3)$ Если $a(x_0, u(x_0)) = 0$ для некоторого $x_0$,
то $a(\cdot, u(x_0)) \equiv 0$. $D_k(a, U(a)) \to 0$.

Возьмем вес $a$, удовлетворяющий $H1$--$H2$.
Из $H2$ следует, что найдется множество $T \subset [-1, 1]$,
состоящее из конечного числа элементов, такое, что
если $x \not \in T$ и $a(x, u) = 0$ для некоторого $u$, то $a(\cdot, u) \equiv 0$.
Вновь воспользуемся леммой (\ref{zeroApprox}) с множеством
$W = u(T) \cup u^*(T)$.

Полученные веса удовлетворяют $H1$--$H2$, поскольку отличаются от $a$ лишь
домножением на непрерывный множитель меньший единицы и зависящий только от $u$.
Кроме того, $\min\limits_{x \in C_k(u)} a(x, u)$ не равен нулю на множестве
$U(b_k)$ начиная с некоторого $k$, значит $D_k(b_k, U(b_k)) = D_k(a, U(b_k)) \to 0$.

\bigskip
$(H4)$ Найдется такое четное $k$, что $a(\cdot, u)$ линейны для каждого $u$ на участках
$[-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}]$.

\bigskip
$(H5)$ Множество $u \in \Real$, для которых $a(\cdot, u)$ имеет участки постоянства,
отличается от множества $u \in \Real$ таких, что $a(\cdot, u) \equiv 0$,
лишь на множество меры $0$.

%$\abs{\{ u \in [\min u(x), \max u(x)]: \prod \left ( a(-1 + \frac{2i}{k}, u) - a(-1 + \frac{2(i + 1)}{k}, u) \right ) = 0 \}} = 0.$
%(Кроме сплошных нулей.) !!! Переписать

Будем добиваться выполнения этих двух условий.
Предположим, функция $a$ удовлетворяет $(H1)$--$(H3)$, в том числе $I(u) < \infty$.
Сначала приблизим ее снизу кусочно линейными.
Поскольку приближающие кусочно линейные функции
по построению будут строго меньше $a$ (кроме нулей), можно пользоваться тем, что
$I(u^*) < \infty$ для таких весов.
И, тем самым, для второго перехода можно пользоваться теоремой о мажорированной сходимости.

Зафиксируем некоторое $k$.
По точкам $a(-1 + \frac{2i}{k}, u)$ для каждого $u$ построим кусочно линейную функцию.
Получившаяся функция $a_k(x, u)$ непрерывна и,
по лемме \ref{piecewiseLinearConcave}, удовлетворяет неравенству
(\ref{almostConcaveSum}).

Возьмем $c_k := (1 - D_k(a_k, U(a_k))) a_k$.
$D_k(a_k, U(a_k))$ положителен и стремится к $0$, поэтому $c_k \to a$.
Покажем, что $c_k \le a$.
Возьмем некоторый
$x \in [-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}] =: [x_1, x_2]$.
Тогда $c_k(x, u(x)) \le \max( c_k(x_1, u(x)), c_k(x_2, u(x)) )$, поскольку
$c_k$ кусочно линейны по $x$. Далее,
$c_k(x_1, u(x)) = (1 - D_k(a_k, U(a_k))) a(x_1, u(x)) \le
a(x_1, u(x)) - \frac{a(x_1, u(x)) - a(x, u(x))}{a(x_1, u(x))} a(x_1, u(x)) = a(x, u(x))$.
Аналогично $c_k(x_2, u) \le a(x, u(x))$.
Тем самым, $c_k(x, u(x)) \le a(x, u(x))$ для любого $x$, и $c_k$ являются допустимыми.

$F(u(x), c_k(x, u(x)) u'(x)) \to F(u(x), a(x, u(x)) u'(x))$ для любой функции $u$.
Кроме того, $F(u(x), a(x, u(x)) u'(x))$ является суммируемой мажорантой.
По теореме Лебега о мажорируемой сходимости, получаем $I(c_k, u) \to I(a, u)$
и $I(c_k, u^*) \to I(a, u^*)$.
Функции $c_k$ удовлетворяют $H1$--$H4$.

Обозначим некоторую $c_k=:c$ и будем приближать ее весами, удовлетворяющими $(H1)$--$(H5)$.
Рассмотрим функцию $\Lambda(x) = \frac{k}{2} (1 - \abs{x})$,
она удовлетворяет условию (\ref{almostConcave}).
Найдется такая функция $t(u) \ge 0$ такая, что $t(u) = 0$ равносильно $c(\cdot, u) \equiv 0$, и
$c(x, u) + \Lambda(x) t(u)$ удовлетворяет условиям $(H1)$--$(H4)$.

А именно: возьмем в качестве $t(u):=D_k(a_k, U(a_k)) \max{\tau \ge 0: \tau \Lambda(x) \le a_k(x, u)}$.
Ясно, что максимальное $\tau = 0$ только если $a_k(\cdot, u) \equiv 0$, иначе нарушается условие
(\ref{almostConcave}).

Тогда для каждого $\alpha \le 1$ функция $a(x, u) + \alpha \Lambda(x) t(u)$
тоже удовлетворяет условиям $(H1)$--$(H4)$.

Покажем, что в окрестности $0$ найдется достаточное количество $\alpha$ таких,
что $a(x, u) + \alpha \Lambda(x) t(u)$ имеет минимально возможное по мере
количество горизонтальных участков.
Обозначим множество $\alpha$, неподходящих на участке $[x_i, x_{i + 1}]$
$$A_i := \{ \alpha \in [0, 1]: \abs{ \{ u \in [\min u, \max u]: a(x_{i + 1}, u) - a(x_i, u)) + \alpha t(u) = 0 \} } > 0 \}.$$
Рассмотрим функцию $h(u) = \frac{a(x_{i + 1}, u) - a(x_i, u)}{t(u)}$ при $t(u) \neq 0$ и $h(u) = 0$ при $t(u) = 0$.
Тогда $\#A_i = \#\{ \alpha \in [0, 1]: \abs{ \{ u \in [\min u, \max u]: h(u) + \alpha = 0 \} } > 0 \} (-1).$
(Во втором множестве может появиться лишний $0$.)
Значит, $\#A_i \le \aleph_0$, а также $\#\cup A_i \le \aleph_0$.
Тем самым, найдется последовательность допустимых функций $a(x, u) + \alpha_j \Lambda(x) t(u)$,
удовлетворяющих $(H1)$--$(H5)$ и сходящихся к $a(x, u)$.

\bigskip
$(H6)$ $[-1, 1]$ можно разбить на конечное число промежутков,
в $u$-окрестности графика $u(x)$ на каждом из которых вес $a$ имеет одну монотонность по $x$.

Прямоугольник $[-1, 1] \times [\min u(x), \max u(x)]$ естественным образом
делится точками излома веса $a$ и точками пересечения участков постоянства $a$
графиком функции $u(x)$ на прямоугольники, в которых вес $a$ имеет постоянную
монотонность по $x$.
Однако, таких прямоугольников может оказаться бесконечное количество.
Кроме того, если функция пересекает горизонтальную границу прямоугольника,
монотонность в $u$-окрестности точки пересечения может меняться.

Возьмем множество
$\{ u \in [\min u(x), \max u(x)]: \prod \left ( a(-1 + \frac{2i}{k}, u) - a(-1 + \frac{2(i + 1)}{k}, u) \right ) = 0 \}$
из $(H5)$ в качестве $W$ для леммы \ref{zeroApprox} и применим ее.
Предположим теперь, что какая-то из $b_k$, полученных в результате
применения леммы, не удовлетворяет $(H6)$.
Это значит, что найдется сколь угодно малый интервал $(u_1, u_2)$,
на котором нельзя покрыть график $u(x)$ прямоугольниками с одинаковой
монотонностью веса по $x$.
Но этот интервал также должен пересекаться с $W$, а тогда, при
достаточно малой величине $u_2 - u_1$, $a(x, u) = 0$ при $u \in [u_1, u_2]$,
что противоречит предположению.

\bigskip
$(H7)$ В $(x, u)$-окрестностях ненулевых минимумов $a(x, u(x))$ вес $a$ не зависит от $x$.
!!! Переформулировать

Применим лемму \ref{zeroApprox}. В качестве множества $W$ возьмем множество
всех $u$, при которых происходит переход графика $u(x)$ из прямоугольника,
в котором вес убывает по $x$ в прямоугольник, в котором вес возрастает.
Очевидно, получившиеся $b_k$ удовлетворяют $(H7)$.