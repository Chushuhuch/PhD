\section{Получение результата в общем случае}

На протяжении всей работы мы накладываем на вес $a$ следующие ограничения:

\smallskip
\noindent
(H1) $a(x, u)$ удовлетворяет неравенству (\ref{almostConcaveSum}),
непрерывна, а также $I(u) < \infty$.
\smallskip

Далее будем накладывать по одному новые условия на вес $a$, каждый раз
показывая, что от нового условия можно избавиться, с тем, чтобы войти в
условия, при которых результат уже доказан.

Схема: $a$ удовлетворяет $H1$--$Hi$.
Строим последовательность $a_k$, удовлетворяющих $H1$--$H(i+1)$
так, чтобы $a^n := \max\limits_{k \le n} a_k$ тоже удовлетворяли
$H1$--$H(i+1)$ и выполнялось
$F(u(x), a^n(x, u(x)) u'(x)) \nearrow F(u(x), a(x, u(x)) u'(x))$ для почти всех $x$.

\begin{prop}
\label{levelDerivative}
Для любой $u \in \W(-1, 1)$ и произвольного $u_0 \in \Real$ выполнено
$u'(x) = 0$ для почти всех $x \in \{ x : u(x) = u_0 \}$.
\end{prop}

Предположим, вес $a$ удовлетворяет $H1$, зафиксируем $\eps > 0, u_0 \in \Real$.
Построим вес $b^{u_0}_\eps (x, u) = c^{u_0}_\eps (u) a(x, u)$ следующим образом.
$c^{u_0}_\eps(u) = 1$ при $\abs{u - u_0} \ge 2 \eps$,
$c^{u_0}_\eps(u) = \frac{\abs{u - u_0} - \eps}{\eps}$ при
$\eps \le \abs{u - u_0} \le 2 \eps$ и
$c^{u_0}_\eps(u) = 0$ при $\abs{u - u_0} \le \eps$.
Легко видеть, что $b^{u_0}_\eps(x, u) \le a(x, u)$ и
$b^{u_0}_\eps(x, u) \nearrow a(x, u)$ при $\eps \to 0$ для всех $x$ и $u \neq u_0$.
Кроме того, $b^{u_0}_\eps(x, u)$ удовлетворяет $H1$, потому что мы домножили
вес $a$ на непрерывный коэффициент, не больший единицы и зависящий только от $u$.

\begin{lm}
$\int_{-1}^1 F(u(x), b^{u_0}_\eps(x, u) u'(x)) dx \to \int_{-1}^1 F(u(x), a(x, u) u'(x)) dx.$
\end{lm}

\begin{proof}
Представим отрезок $[-1, 1]$ в виде $A \cup B$, где
$A = \{x \in [-1, 1] : u(x) \neq u_0\}$, $B = \{x \in [-1, 1] : u(x) = u_0\}$.
По теореме о монотонной сходимости
$\int_A F(u(x), b^{u_0}_\eps(x, u) u'(x)) dx \to
\int_A F(u(x), a(x, u) u'(x)) dx.$
Поскольку $b^{u_0}_\eps(x, u_0) = 0$,
$\int_B F(u(x), b^{u_0}_\eps(x, u) u'(x)) dx = \abs{\{x : u(x) = u_0\}} F(u_0, 0)$.
А ввиду утверждения (\ref{levelDerivative})
$\int_B F(u(x), a(x, u) u'(x)) dx = \abs{\{x : u(x) = u_0\}} F(u_0, 0)$.
\end{proof}


\begin{align*}
(H2) & \text{ Количество нулей функций }
a(\cdot, u) \text{ ограничено }
\text{ константой, не зависящей от }\\& u
\text{ для тех } u \text{, для которых } a(\cdot, u) \not\equiv 0.
\end{align*}

Предположим, вес $a$ удовлетворяет $H1$.
Будем строить приближение для него весами, удовлетворяющими $H1$--$H2$.
Рассмотрим множество $G$ точек $u$, имеющих хотя бы одну окрестность,
в которой $a \not \equiv 0$.
$G := \{u \in \Real| \exists \eps > 0: a(\cdot, [u - \eps, u + \eps]) \not \equiv 0\}$.
Для любого $\delta > 0$ найдется покрытие $G$ конечным числом непересекающихся
интервалов $\{U^\delta_i\}$ такое, что $\sum \abs{U^\delta_i} < \abs{G} + \delta$.
Положим $U^\delta_i = (\alpha^\delta_i - \beta^\delta_i, \alpha^\delta_i + \beta^\delta_i)$
и определим $a_k(x, u) := a(x, u) \prod c_{\beta}^{\alpha} (u)$.
Здесь $\beta=\beta^\delta_i$, $\alpha=\alpha^\delta_i$, $\delta = \frac{1}{k}$.
Таким образом мы получили вес, удовлетворяющий $H1$.
Кроме того, для любого $u$: $a(\cdot, u) \equiv 0$ найдется $\eps > 0$, что
$a_k(\cdot, [u - \eps, u + \eps]) \equiv 0$.
Из этого следует, что $a_k$ удовлетворяет $H2$ (!!!).
$\abs{\{u: a_k(\cdot, u) \not \equiv a(\cdot, u)\}} < \frac{2}{k}$.
Это значит, что, если взять $a^n := \max_{k \le n} a_k$, то
$\abs{\{u: a^n(\cdot, u) \not \equiv a(\cdot, u)\}} < \frac{2}{n} \to 0$,
причем эти множества убывают по вложению.

(!!!?) Чтобы закончить доказательство, модифицировать доказательство леммы
на счетное число (?разных) $u_0$.

\bigskip
\bigskip
\noindent
(H3) Если $a(x_0, u(x_0)) = 0$ и $a(\cdot, u(x_0)) \not\equiv 0$ для некоторого
$x_0$,
то на некотором неточечном отрезке $U$, содержащем $u(x_0)$,
выполнено $a(x_0, U) \equiv 0$
\smallskip

Если $a(x_0, u(x_0)) = 0$, то раздуем вес $a$ в $u(x_0)$.
(Если при $x = x_0$ функция $u$ разрывна, раздуваем в двух точках:
$u(x-)$, $u(x+)$.)
Раздувание: в малой $u$-окрестности делаем вес независящим от
$u$, в некоторой большей окрестности линейно по $u$ соединяем с изначальным
весом. Далее в еще большей окрестности домножаем на коэффициент, зависящий
от $u$ с тем, чтобы получившаяся функция была меньше изначальной. Окрестности
можно выбрать независимо малыми.
Однако, чтобы можно было подобрать коэффициент, необходимо, чтобы во всей
внешней окрестности набор нулей был подмножеством набора нулей при $u(x_0)$.
Это можно обеспечить (!!!)
и непрерывный коэффициент в этом случае существует (!!!).

Далее уменьшаем окрестности, берем максимум первых нескольких приближений.
Такая последовательность приближает вес $a$ снизу, что и требовалось.

$$\leqno(H4) \ a(\cdot, u) \text{ кусочно линейны для каждого } u.$$

Пусть $a$ удовлетворяет $H1$--$H3$.
Фиксируем $\eps$.
В проколотых $\eps$-окрестностях точек множества
$\{x: a(x, u(x)) = 0,\ a( \cdot, u(x) ) \not\equiv 0\}$
заменяем $u$ на константу. Этих точек конечное число (следует из $H2$).
При достаточно малом $\eps$ это не выводит
функцию $u$ из области определения функционала.
Это следует из конечности множества нулей
и того, что для несплошного нуля выполнено $H3$.
Выберем коэффициент $\theta$, домножим на него вес.
Выберем мелкость разбиения. Это можно сделать, поскольку нулей конечное число.
Все нули кроме сплошных должны попасть в узлы.
Проинтерполируем.
Для полученных функций выполняются условия $H1$--$H4$.
Переходим к пределу по мелкости разбиения.
Переходим к пределу по $\eps$.

\begin{align*}
(H5) \ &[-1, 1] \text{ можно разбить на конечное число промежутков, в }
u \text{-окрестности каж-}\\
& \text{дого из которых вес } a \text{ имеет одну монотонность по } x.
\end{align*}

Положим, $a$ удовлетворяет $H1$--$H4$.
Из-за чего может быть бесконечное число промежутков:
I) из-за пересечения бесконечного числа прямоугольников
II) из-за пересечения одной границы прямоугольников неограниченное число раз.
Одинаковая монотонность уже есть, нет окрестности, когда
III) пересекаем горизонтальную границу прямоугольника (в том числе по углу).
Точки типа I могут иметь скопления.
Раздуваем $a$ сначала из них, затем из оставшихся.
Следим, чтобы не нарушались условия $H1$--$H4$ (особенно $H3$),
домножаем на коэффициент (!!!) (нули (см. $H2$) + что вообще можно).

$$\leqno(H6) \text{ В } (x, u) \text{-окрестностях ненулевых минимумов }
a(x, u(x)) \text{ вес } a \text{ не зависит от } x.$$

Если минимум достигается при пересечении горизонтальной границы прямоугольника
(но не через угол),
то все и так есть в силу $H5$,
потому что слева от окрестности точки пересечения будет убывать,
а справа будет возрастать. Но, поскольку вес в некоторой окрестности
линеен по $x$, он в этой окрестности постоянен.
(На самом деле, по построению в $H5$ для угла верно то же самое,
но из формулировки это не следует.)
Если при пересечении вертикальной границы, то в некоторой $u$-окрестности
поднимаем минимумы (!!! как выбрать непрерывно?
Например, если минимум вырождается в нулевой в нашей точке, то поднимать
в ней придется на $0$),
домножаем в чуть большей окрестности.
Множество нулей, монотонность и кусочная линейность остаются (!!!).


Про раздутие: проблемы, очевидно, только в нулях, а именно, в окрестности
раздуваемого уровня ноль может быть более крутой, чем у нас.
Если $u$ через этот ноль не проходит, все хорошо.
Если проходит, то спасет $\eps$-окрестность постоянства $u$.
