\section{Получение результата в общем случае}

На протяжении всей работы мы накладываем на вес $a$ следующие ограничения:

\smallskip
\noindent
(H1) $a(x, u)$ удовлетворяет неравенству (\ref{almostConcaveSum}),
непрерывна, а также $I(u) < \infty$.
\smallskip

Далее будем накладывать по одному новые условия на вес $a$, каждый раз
показывая, что от нового условия можно избавиться, с тем, чтобы войти в
условия, при которых результат уже доказан.

Схема: $a$ удовлетворяет $H1$--$Hi$.
Строим последовательность $a_k$, удовлетворяющих $H1$--$H(i+1)$
так, чтобы $a^n := \max\limits_{k \le n} a_k$ тоже удовлетворяли
$H1$--$H(i+1)$ и выполнялось
$F(u(x), a^n(x, u(x)) u'(x)) \nearrow F(u(x), a(x, u(x)) u'(x))$ для почти всех $x$.

\begin{prop}
\label{levelDerivative}
Для любой $u \in \W(-1, 1)$ и произвольного $u_0 \in \Real$ выполнено
$u'(x) = 0$ для почти всех $x \in \{ x : u(x) = u_0 \}$.
\end{prop}

\begin{lm}
\label{zeroApprox}
Предположим, вес $a$ удовлетворяет $H1$ и имеется замкнутое множество
$W \subset \Real$ такое, что либо оно содержит конечное число элементов,
либо $a|_{u \in W} \equiv 0$.
Тогда найдется последовательность весов $b_k$ такая, что $I(b_k, u) \to I(a, u)$,
для любого $u$ в некоторой окрестности $W$ (зависящей от $k$) $b_k(\cdot, u) \equiv 0$.
\end{lm}

\begin{proof}
Возьмем $b_k(x, u) := a(x, u) \min(1, k \dist(u, W)) \le a(x, u)$.
Этот вес совпадает с $a$ во всем множестве $W$,
если оно не состоит из конечного числа точек, а также во всех точках,
находящихся на расстоянии по крайней мере $\frac{1}{k}$ от $W$.
Кроме того, $b_k(x, u)$ возрастают при увеличении $k$.

Разобьем отрезок $[-1, 1]$ на три множества.
$A := \{ x \in [-1, 1]: u(x) \in \Real \setminus W \}$,
$B := \{ x \in [-1, 1]: u(x) \in W, a(\cdot, u(x)) \equiv 0 \}$,
$C := [-1, 1] \setminus ( A \cup B )$.
$I(A, b_k, u) \nearrow I(A, a, u)$,
поскольку вне множества $W$ $b_k(x, u) \nearrow a(x, u)$.
$I(B, b_k, u) = \int_B F(u(x), 0) dx = I(B, a, u)$.
Множество $C$ содержит конечное число точек: $C = \{c_1, \dots, c_N\}$.
$I(C, b_k, u) = \sum_{i = 1}^N \int\limits_{x : u(x) = c_i} F(c_i, b_k(x, c_i) u'(x)) dx$.
При этом, по утверждению (\ref{levelDerivative}), на каждом из множеств
$\{ x : u(x) = c_i \}$ производная $u'(x)$ почти всюду равна нулю.
То есть,
$I(C, b_k, u) = \sum_{i = 1}^N \int\limits_{x : u(x) = c_i} F(c_i, 0) dx = I(C, a, u)$
(такой интеграл не зависит от веса).
\end{proof}



\begin{align*}
(H2) & \text{ Количество нулей функций }
a(\cdot, u) \text{ ограничено }
\text{ константой, не зависящей от }\\& u
\text{ для тех } u \text{, для которых } a(\cdot, u) \not\equiv 0.
\end{align*}

Предположим, вес $a$ удовлетворяет $H1$.
Будем строить приближение для него весами, удовлетворяющими $H1$--$H2$.
Воспользуемся леммой (\ref{zeroApprox}).
В качестве множества $W$ возьмем $\{ u \in \Real: a(\cdot, u) \equiv 0 \}$.
Остается доказать, что полученные $b_k$ удовлетворяют $H2$. (!!!)

\bigskip
\bigskip
\noindent
(H3) Если $a(x_0, u(x_0)) = 0$ и $a(\cdot, u(x_0)) \not\equiv 0$ для некоторого
$x_0$,
то на некотором неточечном отрезке $U$, содержащем $u(x_0)$,
выполнено $a(x_0, U) \equiv 0$
\smallskip

Если $a(x_0, u(x_0)) = 0$, то раздуем вес $a$ в $u(x_0)$.
(Если при $x = x_0$ функция $u$ разрывна, раздуваем в двух точках:
$u(x-)$, $u(x+)$.)
Раздувание: в малой $u$-окрестности делаем вес независящим от
$u$, в некоторой большей окрестности линейно по $u$ соединяем с изначальным
весом. Далее в еще большей окрестности домножаем на коэффициент, зависящий
от $u$ с тем, чтобы получившаяся функция была меньше изначальной. Окрестности
можно выбрать независимо малыми.
Однако, чтобы можно было подобрать коэффициент, необходимо, чтобы во всей
внешней окрестности набор нулей был подмножеством набора нулей при $u(x_0)$.
Это можно обеспечить (!!!)
и непрерывный коэффициент в этом случае существует (!!!).

Далее уменьшаем окрестности, берем максимум первых нескольких приближений.
Такая последовательность приближает вес $a$ снизу, что и требовалось.

$$\leqno(H4) \ a(\cdot, u) \text{ кусочно линейны для каждого } u.$$

Пусть $a$ удовлетворяет $H1$--$H3$.
Фиксируем $\eps$.
В проколотых $\eps$-окрестностях точек множества
$\{x: a(x, u(x)) = 0,\ a( \cdot, u(x) ) \not\equiv 0\}$
заменяем $u$ на константу. Этих точек конечное число (следует из $H2$).
При достаточно малом $\eps$ это не выводит
функцию $u$ из области определения функционала.
Это следует из конечности множества нулей
и того, что для несплошного нуля выполнено $H3$.
Выберем коэффициент $\theta$, домножим на него вес.
Выберем мелкость разбиения. Это можно сделать, поскольку нулей конечное число.
Все нули кроме сплошных должны попасть в узлы.
Проинтерполируем.
Для полученных функций выполняются условия $H1$--$H4$.
Переходим к пределу по мелкости разбиения.
Переходим к пределу по $\eps$.

\begin{align*}
(H5) \ &[-1, 1] \text{ можно разбить на конечное число промежутков, в }
u \text{-окрестности каж-}\\
& \text{дого из которых вес } a \text{ имеет одну монотонность по } x.
\end{align*}

Положим, $a$ удовлетворяет $H1$--$H4$.
Из-за чего может быть бесконечное число промежутков:
I) из-за пересечения бесконечного числа прямоугольников
II) из-за пересечения одной границы прямоугольников неограниченное число раз.
Одинаковая монотонность уже есть, нет окрестности, когда
III) пересекаем горизонтальную границу прямоугольника (в том числе по углу).
Точки типа I могут иметь скопления.
Раздуваем $a$ сначала из них, затем из оставшихся.
Следим, чтобы не нарушались условия $H1$--$H4$ (особенно $H3$),
домножаем на коэффициент (!!!) (нули (см. $H2$) + что вообще можно).

$$\leqno(H6) \text{ В } (x, u) \text{-окрестностях ненулевых минимумов }
a(x, u(x)) \text{ вес } a \text{ не зависит от } x.$$

Если минимум достигается при пересечении горизонтальной границы прямоугольника
(но не через угол),
то все и так есть в силу $H5$,
потому что слева от окрестности точки пересечения будет убывать,
а справа будет возрастать. Но, поскольку вес в некоторой окрестности
линеен по $x$, он в этой окрестности постоянен.
(На самом деле, по построению в $H5$ для угла верно то же самое,
но из формулировки это не следует.)
Если при пересечении вертикальной границы, то в некоторой $u$-окрестности
поднимаем минимумы (!!! как выбрать непрерывно?
Например, если минимум вырождается в нулевой в нашей точке, то поднимать
в ней придется на $0$),
домножаем в чуть большей окрестности.
Множество нулей, монотонность и кусочная линейность остаются (!!!).


Про раздутие: проблемы, очевидно, только в нулях, а именно, в окрестности
раздуваемого уровня ноль может быть более крутой, чем у нас.
Если $u$ через этот ноль не проходит, все хорошо.
Если проходит, то спасет $\eps$-окрестность постоянства $u$.
