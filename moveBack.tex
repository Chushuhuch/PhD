\section{Получение результата в общем случае}

На протяжении всей работы мы накладываем на вес $a$ следующие ограничения:

\smallskip
\noindent
(H1) $a(x, u)$ удовлетворяет неравенству (\ref{almostConcaveSum}),
непрерывна, а также $I(u) < \infty$.
\smallskip

Будем называть такие функции допустимыми.

Далее будем накладывать по одному новые условия на вес $a$, каждый раз
показывая, что от нового условия можно избавиться, с тем, чтобы войти в
условия, при которых результат уже доказан.

Схема: $a$ удовлетворяет $H1$--$Hi$.
Строим последовательность $a_k$, удовлетворяющих $H1$--$H(i+1)$
так, чтобы $a^n := \max\limits_{k \le n} a_k$ тоже удовлетворяли
$H1$--$H(i+1)$ и выполнялось
\begin{align*}
F(u(x), a^n(x, u(x)) u'(x)) & \nearrow F(u(x), a(x, u(x)) u'(x))\\
F(u^*(x), a^n(x, u^*(x)) {u^*}'(x)) & \nearrow F(u^*(x), a(x, u^*(x)) {u^*}'(x))
\end{align*}
для почти всех $x$.

\begin{prop}
\label{levelDerivative}
\cite[стр. 137]{LL}
Для любой $u \in \W(-1, 1)$ и произвольного $u_0 \in \Real$ выполнено
$u'(x) = 0$ для почти всех $x \in \{ x : u(x) = u_0 \}$.
\end{prop}

\begin{lm}
\label{zeroApprox}
Предположим, вес $a$ является допустимым и имеется замкнутое множество
$W \subset \Real$ такое, что либо оно содержит конечное число элементов,
либо $a|_{u \in W} \equiv 0$.
Тогда найдется последовательность весов $b_k$ такая, что $I(b_k, u) \to I(a, u)$,
и для любого $u$ в некоторой окрестности $W$ (зависящей от $k$) $b_k(\cdot, u) \equiv 0$,
а также $b_k \nearrow a$ для всех $u$, кроме, возможно, конечного количества.
\end{lm}

\begin{proof}
Возьмем $b_k(x, u) := a(x, u) \min(1, \max(0, k \dist(u, W) - 1) \le a(x, u)$.
Этот вес равен нулю в $\left(\frac{1}{k}\right)$-окрестности $W$.
В частности, если $W$ не состоит из конечного числа элементов,
$b_k \equiv a \equiv 0$ при $u \in W$.
Кроме того, $b_k \equiv a$ вне $\left(\frac{2}{k}\right)$-окрестности $W$ и
$b_k(x, u)$ возрастают при увеличении $k$.
Тем самым, $b_k \nearrow a$ при всех $u$ кроме, возможно, конечного количества точек.
Отсюда $I(\Real \setminus W, b_k, u) \nearrow I(\Real \setminus W, a, u)$.

Если $W$ не состоит из конечного числа точек,
$I(W, b_k, u) = \int_W F(u(x), 0) dx = I(W, a, u)$.
В противном случае
$W = \{w_1, \dots, w_N\}$ и
$$I(W, b_k, u) = \sum_{i = 1}^N \int\limits_{x : u(x) = w_i} F(w_i, b_k(x, w_i) u'(x)) dx.$$
При этом, по утверждению (\ref{levelDerivative}), на каждом из множеств
$\{ x : u(x) = w_i \}$ производная $u'(x)$ почти всюду равна нулю.
То есть,
$I(W, b_k, u) = \sum_{i = 1}^N \int\limits_{x : u(x) = w_i} F(w_i, 0) dx = I(W, a, u)$
(такой интеграл не зависит от веса).
\end{proof}


\bigskip
$(H2)$ Количество нулей функций $a(\cdot, u)$ ограничено константой,
не зависящей от $u$ для тех $u \in [\min u(x), \max u(x)]$,
для которых $a(\cdot, u) \not\equiv 0$.

Предположим, вес $a$ является допустимым.
Будем строить приближение для него весами, удовлетворяющими $H1$--$H2$.
Воспользуемся леммой \ref{zeroApprox}.
В качестве множества $W$ возьмем $\{ u \in \Real: a(\cdot, u) \equiv 0 \}$.
Введем обозначение $Z_a(u) := \{ x \in [-1, 1]: a(x, u) = 0 \}$.
Заметим, что множества $Z_{b_k}(u)$ отличаются от $Z_a(u)$ лишь сменой для
некоторых $u$ на весь отрезок $[-1, 1]$.
Нам остается доказать, что полученные $b_k$ удовлетворяют $H2$,
то есть найдется число $p$ такое, что для каждого $u$ множество
$Z_{b_k}(u)$ либо совпадает с отрезком $[-1, 1]$, либо $\#Z_{b_k}(u) \le p$.

Предположим, это не так, и найдется последовательность $u_l$, для которой
$l < \#Z_{b_k}(u_l) < \infty$.
Тогда, после перехода к подпоследовательности, она будет стремиться к некоторому
$u_0$. Более того, $Z_{b_k}(u_l) = Z_a(u_l)$, поскольку $Z_{b_k}(u_l) \neq [-1, 1]$.
Покажем, что $Z_a(u_0) = [-1, 1]$. Из леммы \ref{periodicity} следует, что
множества $Z_a(u_l)$ периодические с периодом не более $\frac{2}{l - 1}$.
Возьмем некоторый $x \in [-1, 1]$. Для каждого $l$ найдется $x_l$ такой, что
$\abs{x - x_l} \le \frac{1}{l - 1}$ и $a(x_l, u_l) = 0$.
Но $a(x_l, u_l) \to a(x, u_0)$.
Тем самым, $a(x, u_0) = 0$ и $Z_a(u_0) = [-1, 1]$.
Но это означает, что для каждого $u$ такого,
что $\abs{u - u_0} \le \frac{1}{k}$, выполнено $b_k(\cdot, u) \equiv 0$,
что противоречит $\#Z_{b_k}(u_l) < \infty$.

\bigskip
Введем обозначение
$$D_k(a, U) := \sup\limits_{u \in U}
\frac{\max\limits_{ \abs{x_1 - x_2} \le \frac{2}{k} } \abs{a(x_1, u) - a(x_2, u)} }
{\min\limits_{x \in [-1, 1]} a(x, u)},$$
а также $U(a) := [\min u(x), \max u(x)] \cap \{ u: a(\cdot, u) \not \equiv 0 \}$.


$(H3)$ Если $a(x, u) = 0$, то $a(\cdot, u) \equiv 0$. $D_k(a, U(a)) \to 0$.

Возьмем вес $a$, удовлетворяющий $H1$--$H2$.
Из $H2$ следует, что найдется множество $T \subset [-1, 1]$,
состоящее из конечного числа элементов, такое, что
если $x \not \in T$ и $a(x, u) = 0$ для некоторого $u$, то $a(\cdot, u) \equiv 0$.
Вновь воспользуемся леммой (\ref{zeroApprox}) с множеством
$W = u(T) \cup u^*(T)$.

Полученные веса удовлетворяют $H1$--$H2$, поскольку отличаются от $a$ лишь
домножением на непрерывный множитель меньший единицы и зависящий только от $u$.
Кроме того, $\min\limits_{x \in [-1, 1]} a(x, u)$ отделен от нуля на множестве
$U(b_k)$, значит $D_k(b_k, U(b_k)) = D_k(a, U(b_k)) \to 0$.

\bigskip
$(H4)$ $a(\cdot, u)$ кусочно линейны для каждого $u$.

Зафиксируем некоторое $k$.
По точкам $a(-1 + \frac{2i}{k}, u)$ для каждого $u$ построим кусочно линейную функцию.
Получившаяся функция $a_k(x, u)$ непрерывна и,
по лемме \ref{piecewiseLinearConcave}, удовлетворяет неравенству
(\ref{almostConcaveSum}).

Возьмем $b_k := (1 - D_k(a_k, U(a_k))) a_k$.
$D_k(a_k, U(a_k))$ положителен и стремится к $0$, поэтому $b_k \to a$.
Покажем, что $b_k \le a$.
Возьмем некоторый
$x \in [-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}] =: [x_1, x_2]$.
Тогда $b_k(x, u) \le \max( b_k(x_1, u), b_k(x_2, u) )$, поскольку
$b_k$ кусочно линейны по $x$. Далее,
$b_k(x_1, u) = (1 - D_k(a_k, U(a_k))) a(x_1, u) \le
a(x_1, u) - \frac{a(x_1, u) - a(x, u)}{a(x_1, u)} a(x_1, u) = a(x, u)$.
Аналогично для $b_k(x_2, u)$.
Тем самым, $b_k(x, u) \le a(x, u)$ и $b_k$ являются допустимыми.

Возьмем теперь $c_l(x, u) := \max_{k \le l} b_k(x, u) \nearrow a(x, u)$.
Эти функции удовлетворяют $H1$--$H4$ и удовлетворяют условию монотонной сходимости.

\begin{align*}
(H5) \ &[-1, 1] \text{ можно разбить на конечное число промежутков, в }
u \text{-окрестности каж-}\\
& \text{дого из которых вес } a \text{ имеет одну монотонность по } x.
\end{align*}

Положим, $a$ удовлетворяет $H1$--$H4$.
Из-за чего может быть бесконечное число промежутков:
I) из-за пересечения бесконечного числа прямоугольников
II) из-за пересечения одной границы прямоугольников неограниченное число раз.
Одинаковая монотонность уже есть, нет окрестности, когда
III) пересекаем горизонтальную границу прямоугольника (в том числе по углу).
Точки типа I могут иметь скопления.
Раздуваем $a$ сначала из них, затем из оставшихся.
Следим, чтобы не нарушались условия $H1$--$H4$ (особенно $H3$),
домножаем на коэффициент (!!!) (нули (см. $H2$) + что вообще можно).

$$\leqno(H6) \text{ В } (x, u) \text{-окрестностях ненулевых минимумов }
a(x, u(x)) \text{ вес } a \text{ не зависит от } x.$$

Если минимум достигается при пересечении горизонтальной границы прямоугольника
(но не через угол),
то все и так есть в силу $H5$,
потому что слева от окрестности точки пересечения будет убывать,
а справа будет возрастать. Но, поскольку вес в некоторой окрестности
линеен по $x$, он в этой окрестности постоянен.
(На самом деле, по построению в $H5$ для угла верно то же самое,
но из формулировки это не следует.)
Если при пересечении вертикальной границы, то в некоторой $u$-окрестности
поднимаем минимумы (!!! как выбрать непрерывно?
Например, если минимум вырождается в нулевой в нашей точке, то поднимать
в ней придется на $0$),
домножаем в чуть большей окрестности.
Множество нулей, монотонность и кусочная линейность остаются (!!!).


Про раздутие: проблемы, очевидно, только в нулях, а именно, в окрестности
раздуваемого уровня ноль может быть более крутой, чем у нас.
Если $u$ через этот ноль не проходит, все хорошо.
Если проходит, то спасет $\eps$-окрестность постоянства $u$.
