\section{The result in the general case}

Now we want to get rid of the monotonicity restriction on the weight.
We do this in several steps.

To begin, we note that all properties of the function $a$ are of interest
only in the neighborhood of the graphs of functions $u$ and $u^*$.

We introduce the following restrictions on the weight function:

\bigskip

\smallskip
\noindent
$(H1)$ $a(x, v)$ satisfies (\ref{almostConcave}), is even in $x$ and $I(a, u) < \infty$.
\smallskip

\bigskip
\noindent
$(H2)$ for $v \in [\min u(x), \max u(x)]$
which satisfy $a(\cdot, v) \not \equiv 0$
the number of zeros of $a(\cdot, v)$ is bounded by a constant
independent of $v$.

\bigskip
\noindent
$(H3)$ If $a(x_0, u(x_0)) = 0$ for some $x_0$, then $a(\cdot, u(x_0)) \equiv 0$.
Moreover, $\lim_{k \to \infty} D_k(a, U(a)) = 0$, where
$$U(a) := \{ v \in [\min u(x), \max u(x)]: a(\cdot, v) \not \equiv 0 \},$$
\begin{equation}
\label{bigD}
D_k(a, U): = \sup \limits_{v \in U}
\frac{\max \limits_{\abs{x_1 - x_2} \le \frac{2}{k}} \abs{a(x_1, v) - a(x_2, v)}}
{\min \limits_{\dist (x, u^{-1} (v)) \le \frac{2}{k}} a(x, v)}.
\end{equation}

\bigskip
\noindent
$(H4)$ There exists an even $k$, such that $a(\cdot, v)$ are linear for each $v$ on each of the segments
$[-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}]$.

\bigskip
\noindent
$(H5)$ the difference between the
set of $v \in \Real$, for which $a(\cdot, v)$ has segments of constant values,
and the set of $v \in \Real$ such that $a(\cdot, v) \equiv 0$
has zero measure.

\bigskip
\noindent
$(H6)$ the segment $[-1, 1]$ can be decomposed into a finite number of intervals
on each of which $a$ does not change the monotonicity in $x$ in a $v$-neighborhood of the graph of $u(x)$.

\bigskip
\noindent
$(H7)$ Let $x_1 < x_2 < x_3$,
let $a(\cdot, v)$ decrease on $[x_1, x_2]$ in a $v$-neighborhood of the graph of the function $u$,
and let $a(\cdot, v)$ increase on $[x_1, x_2]$ in a $v$-neighborhood of the graph of the function $u$.
Then in a neighborhood of $u(x_2)$, we have $a(\cdot, v) \equiv 0$.

\bigskip

We will call the weights satisfying $(H1)$ admissible.

Now we can formulate the main assertion of our work.
\begin{thm}
\label{mainThm}
Suppose $F \in \mathfrak{F}$, the function $u \in \W(-1, 1)$ is non-negative,
and the weight function $a: [-1, 1] \times \Real_+ \to \Real_+$ is continuous
and is admissible for $u$.
Then the inequality $(\ref{toprove})$ holds.
\end{thm}

We prove the inequality (\ref{toprove}) under the conditions $(H1)-(H7)$,
and then get rid of extra conditions one by one.

For the proof we need the following facts.

\begin{prop}
\label{levelDerivative}
{\rm \cite[Theorem 6.19]{LL} }
For every $u \in \W(-1, 1)$ and an arbitrary set $A \subset \Real$ of zero measure
$u'(x) = 0$ for almost all $x \in u^{-1}(A)$.
\end{prop}

\begin{lm}
\label{zeroApprox}
Suppose $u \in \W(-1, 1)$ and the weight $a$ is asmissible for $u$.
Let the closed set $W \subset \Real$ satisfy the following:
the set of $v \in W$, for which $a(\cdot, v) \not\equiv 0$, has zero measure.
Then there exists an increasing sequence of weights $b_k$ admissible for $u$ such that

1) $b_k(\cdot, v) \rightrightarrows a(\cdot, v)$ for almost all $v$;

2) $b_k(\cdot, v) \equiv 0$ for every $v$ in some neighborhood of $W$ (with neighbourhood depending on $k$);

3) $I(b_k, u) \to I(a, u)$.
\end{lm}

\begin{proof}
Take $\rho(d) := \min(1, \max(0, d))$,
$$b_k(x, v) := a(x, v) \cdot \rho(k \dist(v, W) - 1) \le a(x, v).$$
This weight is equal to zero in $\left(\frac{1}{k}\right)$-neighborhood of $W$.
In addition, $b_k \equiv a$ outside the $\left(\frac{2}{k}\right)$-neighborhood of $W$ and
$b_k(x, v)$ increases with $k$.
Thus, $b_k(\cdot, v) \rightrightarrows a(\cdot, v)$ for almost all $v$.
By the monotone convergence theorem
$I(u^{-1}(\Real \setminus W), b_k, u) \nearrow I(u^{-1}(\Real \setminus W), a, u)$.

Divide the set $W$ into $W_1 := \{v \in W: a(\cdot, v) \equiv 0\}$ and $W_2 = W \setminus W_1$.
Then
$$
\begin{aligned}
I(u^{-1}(W_1), b_k, u) &= I(u^{-1}(W_1), a, u),\\
I(u^{-1}(W_2), b_k, u) &= \int\limits_{x \in u^{-1}(W_2)} F(u(x), b_k(x, u(x)) u'(x)) dx.
\end{aligned}
$$
By Proposition \ref{levelDerivative}, $u'(x) = 0$ almost everywhere on $u^{-1}(W_2)$.
Thus
$$I(u^{-1}(W_2), b_k, u) = \int\limits_{x \in u^{-1}(W_2)} F(u(x), 0) dx = 0.$$
Similarly, $I(u^{-1}(W_2), a, u) = 0$. Hence $I(b_k, u) \to I(a, u)$.
\end{proof}

We proceed to the proof of the theorem.

\bigskip
{\bf Step 1.} Let $u \in \W(-1, 1)$ and let weight $a$ satisfy the conditions $(H1)-(H7)$.
Then the inequality (\ref{toprove}) holds.

Divide the interval $[-1, 1]$ into $\Delta_k$, each consisting of two parts.
On the left part of each $\Delta_k$ weight $a$ increases in $x$ in the neighborhood
of the graph of $u(x)$. On the right part it decreases.
On each $\Delta_k$ we can apply the construction from the previous section
for approximating $u$ with Lipschitz functions $u_n$.
This gives us $I(\Delta_k, a, u_n) \to I(\Delta_k, a, u)$.

However, approximation functions $u_n$ have discontinuities at the boundaries of the segments $\Delta_k$
(denote them by $\hat{x}_k$).

Note that according to the condition $(H7)$ one can choose points $\hat{x}_k$ so
that $a \equiv 0$ in $(x, v)$-neighborhood of the points $(\hat{x}_k, u(\hat{x}_k))$.

Next substitute functions $u_n$ in the neighborhoods of $\hat{x}_k$ with linear pieces
making $u_n$ continuous on $[-1, 1]$.
In view of the above, this does not change the integrals $I(\Delta_k, a, u_n)$,
and we get $I(a, u_n) \to I(a, u)$.

By Lemma \ref{uplift} we obtain (\ref{toprove}).

\bigskip

{\bf Step 2.} Let weight $a$ satisfy the conditions $(H1)-(H6)$.
Then the inequality (\ref{toprove}) holds.

We apply Lemma \ref{zeroApprox} with the following set $W$:
the set of all $v$, at which the graph of $u(x)$ traverses from a rectangle,
in which the weight decreases in $x$,
to a rectangle in which the weight increases.
Obviously, the resulting function $b_k$ satisfy $(H1)-(H7)$.
Therefore, $I(b_k, u^*) \le I(b_k, u)$.
Passing to the limit, we obtain (\ref{toprove}).

\bigskip

{\bf Step 3.} Let weight $a$ satisfy the conditions $(H1)-(H5)$.
Then the inequality (\ref{toprove}) holds.

Consider abscissae of nodes of $a$
and ordinates, for which $a$ has constant pieces.
They define a division of the rectangle $[-1, 1] \times [\min u(x), \max u(x)]$
into rectangles in each of which the weight $a$ is monotone in $x$.
However, the number of rectangles can be infinite.
Also, if the function crosses a horizontal boundary of some rectangle,
monotonicity in the $v$-neighborhood of the point of intersection may change.

Consider set $W$ containing all $v$, for which the weight $a$ has constant pieces.
Due to condition $(H5)$ the set of all $v \in W$, for which $a(\cdot, v) \not\equiv 0$,
has zero measure.

Applying Lemma \ref{zeroApprox}, we obtain a sequence of weights $b_k$.
Each of them, the number of intervals of monotonicity of course,
as between neighboring $v$ portions strict monotonicity
present band width zero weights at least $\frac{2}{k}$.

We now at each site monotony point on the graph of $u$.
Set of these points can not have points cluster
as between the points at which different monotony
distance $v$ at least $\frac{2}{k}$.

Thereby, $b_k$ satisfy $(H1)-(H6)$. Therefore, $I(b_k, u^*) \le I(b_k, u)$.
Passing to the limit, we obtain (\ref{toprove}).

\bigskip
{\bf Step 4.} Let weight $a$ satisfies the conditions $(H1)-(H3)$.
Then the inequality (\ref{toprove}).

Suppose the function $a$ satisfies $(H1)-(H3)$, including $I(a, u) < \infty$.

We fix an arbitrary even $k$.
Points on $a(-1 + \frac{2i}{k}, v)$ for each $v$ construct a piecewise linear in $x$ interpolation.
Resulting function $a_k(x, v)$ is continuous, even, and,
By Lemma \ref{piecewiseLinearConcave}, satisfies
(\ref{almostConcave}).
In addition, $a_k \to a$ when $k \to \infty$,
the convergence is uniform on compact sets.
However, the inequality $a_k(x, u(x)) \le a(x, u(x))$ is not required to be performed,
and because the weight $a_k$ may not be valid for $u$.

Take $c_k := (1 - D_k(a_k, U(a_k))) a_k$, where $D_k$ defined in (\ref{bigD}).
Number $D_k(a_k, U(a_k))$ are positive and tend to zero, so $c_k \to a$ with $k \to \infty$.
We show that $c_k(x, u(x)) \le a(x, u(x))$.
Take some
$x \in [-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}] =: [x_i, x_{i + 1}]$.
Then $c_k(x, u(x)) \le \max( c_k(x_i, u(x)), c_k(x_{i + 1}, u(x)) )$, because
$c_k$ piecewise linear in $x$. Further,
\begin{multline*}
c_k (x_i, u (x)) = ( 1 - D_k (a_k, U (a_k))) \cdot a (x_i, u (x)) \\
\le a (x_i, u (x)) - \frac{a (x_i, u (x)) - a (x, u (x))}{a (x_i, u (x))} \cdot a ( x_i, u (x)) = a (x, u (x)).
\end{multline*}
Similarly $c_k(x_{i + 1}, u(x)) \le a(x, u(x))$.
Thus, $c_k(x, u(x)) \le a(x, u(x))$ for any $x$, and $c_k$ are valid for $u$.

Functions $c_k$ satisfy $(H1)-(H4)$.

For a given $k \in \Nat$, we approximate the function $c_k =: c$ weights satisfying $(H1)-(H5)$.
Consider the auxiliary function $\Lambda(x) = 1 - \abs{x}$,
satisfying (\ref{almostConcave}).

Take
$$t(v):=D_k(c, U(c)) \cdot \max\{\tau \ge 0: \forall x \in u^{-1}(v) \quad \tau \Lambda(x) \le c(x, u(x))\}.$$
Function $t$ depends on $k$, but we omit it in the record.

It is clear that the maximum $\tau$ is zero only if $c(\cdot, v) \equiv 0$, otherwise condition is violated
$(H3)$.
Function $t$ can not be continuous. However, it is easy to see that it is lower semicontinuous.
We now take
$$\tilde{t}(v) := \inf_{w \in u([-1, 1])} \{t(w) + |v - w|\}.$$
It is obvious that $\tilde{t} \le t$, and the set of zeros of $t$ and $\tilde{t}$ coincide.

We show that $\tilde{t}$ is continuous (and even Lipschitz ).
Fix some $v_1$.
Then there is an arbitrarily small $\eps > 0$ and $w_1 \in u([-1, 1])$
satisfying $\tilde{t}(v_1) = t(w_1) + |v_1 - w_1| - \eps$.
For every $v_2$, we have $\tilde{t}(v_2) \le t(w_1) + |v_2 - w_1|$.
And, thus, $\tilde{t}(v_2) - \tilde{t}(v_1) \le |v_1 - v_2| + \eps$.
By the arbitrariness of $v_1$, $v_2$ and $\eps$, we obtain that $\tilde{t}$ is continuous.

When $\alpha \in [0, 1]$ function $d_\alpha(x, v) := c(x, v) + \alpha \Lambda(x) \tilde{t}(v)$
even with respect to $x$, satisfies (\ref{almostConcave}) by Lemma \ref{maxSumConcave}
and does not exceed $a(x, v)$ for construction of the function $\tilde{t}$.
Thus, $d_\alpha$ --- allowable weight.
Further, it is obvious that $d_\alpha$ satisfies $(H1)-(H4)$.

We show that there exists a sequence $\alpha_j \searrow 0$
that $d_{\alpha_j}$ has no horizontal sections, except
Continuum of zeros and a set of measure $0$.
Denote the set of $\alpha$, `` bad '' on the site $[x_i, x_{i + 1}]$:
\begin{multline*}
A_i: = \big \{\alpha \in [ 0, 1 ] \\
meas \{v \in [\min u, \max u]: \frac{c (x_{i + 1}, v) - c (x_i, v))}{\frac{2}{k}} + \alpha \chi_i \tilde{t} (v) = 0 \} > 0 \big \},
\end{multline*}
where $\chi_i = 1$, if $[x_i, x_{i + 1}] \subset [0, 1]$, and $\chi_i = -1$, if $[x_i, x_{i + 1}] \subset [-1, 0]$.

Consider the function
$$
\begin{aligned}
h (v) = & \frac{c (x_{i + 1}, v) - c (x_i, v)}{\tilde{t} (v)} & \text{ if} \tilde{t} ( v) \neq 0 & \\
h (v) = & 0 & \text{ if } \tilde{t} (v) = 0 &.
\end{aligned}
$$
Then $\card(A_i) = \card(\{ \alpha \in [0, 1]: meas \{ v \in [\min u, \max u]: h(v) \pm \frac{2}{k}\\alpha = 0 \} > 0 \}).$
So, $\card(A_i) \le \aleph_0$, and $\card(\cup_i A_i) \le \aleph_0$.
Thus, there is a sequence of weights $d_{\alpha_j} \searrow c$, satisfying $(H1)-(H5)$.
Therefore, $I(d_{\alpha_j}, u^*) \le I(d_{\alpha_j}, u)$.
Passing to the limit, we get $I(c, u^*) \le I(c, u)$.

Further, if $x \in [-1, 1]$ and $k \to \infty$, we have
$$F(u(x), c_k(x, u(x)) |u'(x)|) \to F(u(x), a(x, u(x)) |u'(x)|).$$
Additionally, $F(u(x), a(x, u(x)) |u'(x)|)$ Majorant is integrable.
By the Lebesgue dominated convergence, we get $I(c_k, u) \to I(a, u)$.
Since $I(c_k, u^*) \le I(c_k, u)$, Lemma \ref{uplift} gives (\ref{toprove}).

\bigskip
{\bf Step 5.} Let weight $a$ satisfies only the condition $(H1)$.
Then the inequality (\ref{toprove}).

We will construct an approximation for weights $a$ satisfying $(H1)-(H2)$.
Use Lemma \ref{zeroApprox}.
As the set $W$ we take $\{ v \in \Real: a(\cdot, v) \equiv 0 \}$.
We introduce the notation $$Z_a(v) := \{ x \in [-1, 1]: a(x, v) = 0 \}.$$
Note that the sets $Z_{b_k}(v)$ coincide with either $Z_a(v)$, either $[-1, 1]$.

We show that $b_k$ satisfies $(H2)$.
Indeed, otherwise there is a sequence $v_l$, for which
$l < \card(Z_{b_k})(v_l) < \infty$.
After passing to a subsequence, we have $v_l \to v_0$.
We show that $Z_a(v_0) = [-1, 1]$. Lemma \ref{periodicity} implies that
set $Z_{b_k}(v_l) = Z_a(v_l)$ periodic with period of not more than $\frac{2}{l - 1}$.
Take some $x \in [-1, 1]$. For each $l$ $x_l$ exists such that
$\abs{x - x_l} \le \frac{1}{l - 1}$ and $a(x_l, v_l) = 0$.
But $a(x_l, v_l) \to a(x, v_0)$.
Thus, $a(x, v_0) = 0$ and $Z_a(v_0) = [-1, 1]$.
But this means that for every $v$ such
that $\abs{v - v_0} \le \frac{1}{k}$, holds $b_k(\cdot, v) \equiv 0$
which contradicts $\card(Z_{b_k})(v_l) < \infty$.


Now we fix $k \in \Nat$, denoted $b_k =: b$
and approximate the function $b$ weights satisfying $(H1)-(H3)$.
From $(H2)$ and Lemma \ref{periodicity}, part 2, it follows that there exists a set $T \subset [-1, 1]$
consisting of a finite number of elements, such that
if $x \not \in T$ and $a(x, v) = 0$ for some $v$, then $b(\cdot, v) \equiv 0$.
Again, we use Lemma \ref{zeroApprox} with multiple
$W = u(T) \cup u^*(T)$.

Obtained with the help of Lemma weight $c_j$ satisfy $(H1)-(H2)$, as distinguished from a $b$
continuous multiplication by a factor less than unity and depends only on $v$.
Obviously, $\min\limits_{dist(x, u^{-1}(v)) \le \frac{2}{j}} c_j(x, v)$ is not equal to zero
$v \in U(c_j)$, starting with some $j$.
Moreover, when $v \in U(c_j)$
$$
\frac{\max\limits_{\abs{x_i - x_{i + 1}} \le \frac{2}{j}} \abs{c_j(x_i, v) - c_j(x_{i + 1}, v)}}
{\min\limits_{\dist(x, u^{-1}(v)) \le \frac{2}{j}} c_j(x, v)}
=\frac{\max\limits_{\abs{x_i - x_{i + 1}} \le \frac{2}{j}} \abs{b(x_i, v) - b(x_{i + 1}, v)}}
{\min\limits_{\dist(x, u^{-1}(v)) \le \frac{2}{j}} b(x, v)}.
$$
In this case, the denominator of the second fraction at $v \in U(c_j)$ bounded away from zero.
Thus, $D_j(c_j, U(c_j))$ is bounded.

Since $D_j$ is not changed by multiplying by a factor of the first argument, which is independent of $x$,
and $U(c_j) \nearrow U(b)$, we have for $j \to \infty$
$$D_j(c_j, U(c_j)) = D_j(b, U(c_j)) \le D_j(b, U(b)) \to 0.$$

Thus, the weights satisfy $c_j$ $(H1)-(H3)$.
Thus, $I(c_j, u^*) \le I(c_j, u)$.
Passing to the limit, we get $I(b_k, u^*) \le I(b_k, u)$, then the inequality (\ref{toprove}).

Thus, Theorem \ref{mainThm} proved.
\hfill $\square$

\medskip

We now consider the case where the function $u$ satisfies the additional condition $u(-1) = 0$.
\begin{thm}
Let $F \in \mathfrak{F}$, the function $u \in \W(-1, 1)$ is nonnegative, $u(-1) = 0$,
weight function $a: [-1, 1] \times \Real_+ \to \Real_+$ continuous
and satisfies $(\ref{almostConcave})$.
Then the inequality $(\ref{toprove})$.
\end{thm}

\begin{proof}
We follow the proof of Theorem \ref{mainThm},
but instead of $(H1)$ and $(H7)$ impose the following conditions on the weight:

\bigskip
\noindent
$(H1')$ $a(x, v)$ satisfies (\ref{almostConcave}), and $I(a, u) < \infty$.

\bigskip
\noindent
$(H7')$ Achieved condition $(H7)$, and $a(\cdot, v) \equiv 0$ in some $v$- neighborhood of zero.

\bigskip
{\bf Step 1.} Let $u \in \W(-1, 1)$, the $u(-1) = 0$ and the weight $a$ satisfies the conditions $(H1'), (H2)-(H6), (H7')$.
Then the inequality (\ref{toprove}).

For proof we approximate the function $u$ in the same way as in the first step of the proof of Theorem \ref{mainThm},
the replacement of $u$ in a neighborhood of $x = -1$ on the linear so that $u_n(-1) = 0$.

\bigskip
{\bf Step 2.} Let weight $a$ satisfies the conditions $(H1'), (H2)-(H6)$.
Then the inequality (\ref{toprove}).

To prove to add to the set $W$ of the second step of the proof of Theorem \ref{mainThm} point $0$
and repeat the argument.

\medskip

Further steps are unchanged.
\end{proof}

