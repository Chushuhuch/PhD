\section{The result in the general case}

Now we want to get rid of the monotonicity restriction on the weight.
We do this in several steps.

To begin, we note that all properties of the function $\mathfrak a$ are of interest
only in the neighborhood of the graphs of functions $u$ and $u^*$.

We introduce the following conditions each of which, being added to the previous ones, defines a smaller class of weight functions:

\bigskip

\smallskip
\noindent
$(H1)$ $\mathfrak a(x, v)$ satisfies (\ref{almostConcave}), is even in $x$ and $I(\mathfrak a, u) < \infty$.
\smallskip

\bigskip
\noindent
$(H2)$ the number of zeros of $\mathfrak a(\cdot, v)$ is bounded by a constant independent of $v$
for all $v \in [\min u(x), \max u(x)]$ such that $\mathfrak a(\cdot, v) \not \equiv 0$.

\bigskip
\noindent
$(H3)$ If $\mathfrak a(x_0, u(x_0)) = 0$ for some $x_0$, then $\mathfrak a(\cdot, u(x_0)) \equiv 0$.
Moreover, $\lim\limits_{k \to \infty} D_k(\mathfrak a, U(\mathfrak a)) = 0$, where
$$U(\mathfrak a) := \{ v \in [\min u(x), \max u(x)]: \mathfrak a(\cdot, v) \not \equiv 0 \},$$
\begin{equation}
\label{bigD}
D_k(\mathfrak a, U): = \sup \limits_{v \in U}
\frac{\max \limits_{\abs{x_1 - x_2} \le \frac{2}{k}} \abs{\mathfrak a(x_1, v) - \mathfrak a(x_2, v)}}
{\min \limits_{\dist (x, u^{-1} (v)) \le \frac{2}{k}} \mathfrak a(x, v)}.
\end{equation}

\bigskip
\noindent
$(H4)$ There exists an even $k$, such that $\mathfrak a(\cdot, v)$ are linear for each $v$ on each of the segments
$[-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}]$.

\bigskip
\noindent
$(H5)$ The difference between the
set of $v \in \Real$, for which $\mathfrak a(\cdot, v)$ has segments of constant values,
and the set of $v \in \Real$ such that $\mathfrak a(\cdot, v) \equiv 0$
has zero measure.

\bigskip
\noindent
$(H6)$ The segment $[-1, 1]$ can be represented as a unity of touching segments
on each of which $\mathfrak a$ does not change the monotonicity in $x$ in a $v$-neighborhood of the graph of the function $u$.

\bigskip
\noindent
$(H7)$ Let $x_1 < x_2 < x_3$,
let $\mathfrak a(\cdot, v)$ decrease for $x \in [x_1, x_2]$ in a $v$-neighborhood of the graph of the function $u$,
and let $\mathfrak a(\cdot, v)$ increase for $x \in [x_1, x_2]$ in a $v$-neighborhood of the graph of the function $u$.
Then we have $\mathfrak a(\cdot, v) \equiv 0$ in a $v$-neighborhood of $u(x_2)$.

\bigskip

The weights satisfying $(H1)$ will be called {\it admissible for a given $u$}.

\medskip

Now we can formulate the main assertion of our work.
\begin{thm}
\label{mainThm}
Suppose $F \in \mathfrak{F}$, the function $u \in \W(-1, 1)$ is non-negative,
and the weight function $\mathfrak a: [-1, 1] \times \Real_+ \to \Real_+$ is continuous
and admissible for $u$.
Then the inequality $(\ref{toprove})$ holds.
\end{thm}

We prove the inequality (\ref{toprove}) under conditions $(H1)-(H7)$,
and then get rid of extra conditions one by one.

For the proof we need the following facts.

\begin{prop}
\label{levelDerivative}
{\rm \cite[Theorem 6.19]{LL} }
For every $u \in \W(-1, 1)$ and for an arbitrary set $A \subset \Real$ of zero measure
$u'(x) = 0$ almost everywhere in $u^{-1}(A)$.
\end{prop}

\begin{lm}
\label{zeroApprox}
Suppose that $u \in \W(-1, 1)$ and the weight $\mathfrak a$ is admissible for $u$.
Let a closed set $W \subset \Real$ be such that:
the set of $v \in W$, for which $\mathfrak a(\cdot, v) \not\equiv 0$, has zero measure.
Then there exists an increasing sequence of weights $\mathfrak b_k$ admissible for $u$ such that

1) $\mathfrak b_k(\cdot, v) \rightrightarrows \mathfrak a(\cdot, v)$ for almost all $v$;

2) $\mathfrak b_k(\cdot, v) \equiv 0$ for every $v$ in some neighborhood of $W$ (the neighbourhood depends on $k$);

3) $I(\mathfrak b_k, u) \to I(\mathfrak a, u)$.
\end{lm}

\begin{proof}
Take $\rho(d) := \min(1, \max(0, d))$,
$$\mathfrak b_k(x, v) := \mathfrak a(x, v) \cdot \rho(k \dist(v, W) - 1) \le \mathfrak a(x, v).$$
This weight is equal to zero in $\left(\frac{1}{k}\right)$-neighborhood of $W$.
In addition, $\mathfrak b_k \equiv \mathfrak a$ outside the $\left(\frac{2}{k}\right)$-neighborhood of $W$ and
$\mathfrak b_k(x, v)$ increases with $k$.
Thus, $\mathfrak b_k(\cdot, v) \rightrightarrows \mathfrak a(\cdot, v)$ for almost all $v$.
By the monotone convergence theorem
$I(u^{-1}(\Real \setminus W), \mathfrak b_k, u) \nearrow I(u^{-1}(\Real \setminus W), \mathfrak a, u)$.

Divide the set $W$ into $W_1 := \{v \in W: \mathfrak a(\cdot, v) \equiv 0\}$ and $W_2 = W \setminus W_1$.
Then
$$
\begin{aligned}
I(u^{-1}(W_1), \mathfrak b_k, u) &= I(u^{-1}(W_1), \mathfrak a, u),\\
I(u^{-1}(W_2), \mathfrak b_k, u) &= \int\limits_{x \in u^{-1}(W_2)} F(u(x), \mathfrak b_k(x, u(x)) u'(x)) \, dx.
\end{aligned}
$$
By Proposition \ref{levelDerivative}, $u'(x) = 0$ almost everywhere on $u^{-1}(W_2)$.
Thus
$$I(u^{-1}(W_2), \mathfrak b_k, u) = \int\limits_{x \in u^{-1}(W_2)} F(u(x), 0) \, dx = 0.$$
Similarly, $I(u^{-1}(W_2), \mathfrak a, u) = 0$. Hence $I(\mathfrak b_k, u) \to I(\mathfrak a, u)$.
\end{proof}

We proceed to the proof of the theorem.

\bigskip
{\bf Step 1.} Let $u \in \W(-1, 1)$ and let weight $\mathfrak a$ satisfy the conditions $(H1)-(H7)$.
Then the inequality (\ref{toprove}) holds.

Divide the interval $[-1, 1]$ into $\Delta_k$, each consisting of two parts.
On the left part of each $\Delta_k$ weight $\mathfrak a$ increases in $x$ in the neighborhood
of the graph of $u(x)$. On the right part it decreases.
On each $\Delta_k$ we can apply the construction from the previous section
for approximating $u$ with Lipschitz functions $u_n$.
This gives us $I(\Delta_k, \mathfrak a, u_n) \to I(\Delta_k, \mathfrak a, u)$.

However, approximation functions $u_n$ have discontinuities at the boundaries of the segments $\Delta_k$
(denote them by $\hat{x}_k$).

Note that according to the condition $(H7)$ one can choose points $\hat{x}_k$ so
that $\mathfrak a \equiv 0$ in $(x, v)$-neighborhood of the points $(\hat{x}_k, u(\hat{x}_k))$.

Next substitute functions $u_n$ in the neighborhoods of $\hat{x}_k$ with linear pieces
making $u_n$ continuous on $[-1, 1]$.
In view of the above, this does not change the integrals $I(\Delta_k, \mathfrak a, u_n)$,
and we get $I(\mathfrak a, u_n) \to I(\mathfrak a, u)$.

By Lemma \ref{uplift} we obtain (\ref{toprove}).

\bigskip

{\bf Step 2.} Let weight $\mathfrak a$ satisfy the conditions $(H1)-(H6)$.
Then the inequality (\ref{toprove}) holds.

We apply Lemma \ref{zeroApprox} with the following set $W$:
the set of all $v$, at which the graph of $u(x)$ traverses from a rectangle,
in which the weight decreases in $x$,
to a rectangle in which the weight increases.
Obviously, the resulting function $\mathfrak b_k$ satisfy $(H1)-(H7)$.
Therefore, $I(\mathfrak b_k, u^*) \le I(\mathfrak b_k, u)$.
Passing to the limit, we obtain (\ref{toprove}).

\bigskip

{\bf Step 3.} Let weight $\mathfrak a$ satisfy the conditions $(H1)-(H5)$.
Then the inequality (\ref{toprove}) holds.

Consider abscissae of nodes of $\mathfrak a$
and ordinates, for which $\mathfrak a$ has constant pieces.
They define a division of the rectangle $[-1, 1] \times [\min u(x), \max u(x)]$
into rectangles in each of which the weight $\mathfrak a$ is monotone in $x$.
However, the number of rectangles can be infinite.
Also, if the function crosses a horizontal boundary of some rectangle,
monotonicity in the $v$-neighborhood of the point of intersection may change.

Consider set $W$ containing all $v$, for which the weight $\mathfrak a$ has constant pieces.
Due to condition $(H5)$ the set of all $v \in W$, for which $\mathfrak a(\cdot, v) \not\equiv 0$,
has zero measure.

Applying Lemma \ref{zeroApprox}, we obtain a sequence of weights $\mathfrak b_k$.
Each of them, the number of intervals of monotonicity of course,
as between neighboring $v$ portions strict monotonicity
present band width zero weights at least $\frac{2}{k}$.

We now at each site monotony point on the graph of $u$.
Set of these points can not have points cluster
as between the points at which different monotony
distance $v$ at least $\frac{2}{k}$.

Thereby, $\mathfrak b_k$ satisfy $(H1)-(H6)$. Therefore, $I(\mathfrak b_k, u^*) \le I(\mathfrak b_k, u)$.
Passing to the limit, we obtain (\ref{toprove}).

\bigskip
{\bf Step 4.} Let weight $\mathfrak a$ satisfies the conditions $(H1)-(H3)$.
Then the inequality (\ref{toprove}).

Suppose the function $\mathfrak a$ satisfies $(H1)-(H3)$, including $I(\mathfrak a, u) < \infty$.

We fix an arbitrary even $k$.
Points on $\mathfrak a(-1 + \frac{2i}{k}, v)$ for each $v$ construct a piecewise linear in $x$ interpolation.
Resulting function $\mathfrak a_k(x, v)$ is continuous, even, and,
By Lemma \ref{piecewiseLinearConcave}, satisfies
(\ref{almostConcave}).
In addition, $\mathfrak a_k \to \mathfrak a$ when $k \to \infty$,
the convergence is uniform on compact sets.
However, the inequality $\mathfrak a_k(x, u(x)) \le \mathfrak a(x, u(x))$ is not required to be performed,
and because the weight $\mathfrak a_k$ may not be valid for $u$.

Take $\mathfrak c_k := (1 - D_k(\mathfrak a_k, U(\mathfrak a_k))) \mathfrak a_k$, where $D_k$ defined in (\ref{bigD}).
Number $D_k(\mathfrak a_k, U(\mathfrak a_k))$ are positive and tend to zero, so $\mathfrak c_k \to \mathfrak a$ with $k \to \infty$.
We show that $\mathfrak c_k(x, u(x)) \le \mathfrak a(x, u(x))$.
Take some
$x \in [-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}] =: [x_i, x_{i + 1}]$.
Then $\mathfrak c_k(x, u(x)) \le \max( \mathfrak c_k(x_i, u(x)), \mathfrak c_k(x_{i + 1}, u(x)) )$, because
$\mathfrak c_k$ piecewise linear in $x$. Further,
\begin{multline*}
\mathfrak c_k (x_i, u (x)) = ( 1 - D_k (\mathfrak a_k, U (\mathfrak a_k))) \cdot \mathfrak a (x_i, u (x)) \\
\le \mathfrak a (x_i, u (x)) - \frac{\mathfrak a (x_i, u (x)) - \mathfrak a (x, u (x))}{\mathfrak a (x_i, u (x))} \cdot \mathfrak a ( x_i, u (x)) = \mathfrak a (x, u (x)).
\end{multline*}
Similarly $\mathfrak c_k(x_{i + 1}, u(x)) \le \mathfrak a(x, u(x))$.
Thus, $\mathfrak c_k(x, u(x)) \le \mathfrak a(x, u(x))$ for any $x$, and $\mathfrak c_k$ are valid for $u$.

Functions $\mathfrak c_k$ satisfy $(H1)-(H4)$.

For a given $k \in \Nat$, we approximate the function $\mathfrak c_k =: \mathfrak c$ weights satisfying $(H1)-(H5)$.
Consider the auxiliary function $\Lambda(x) = 1 - \abs{x}$,
satisfying (\ref{almostConcave}).

Take
$$t(v):=D_k(\mathfrak c, U(\mathfrak c)) \cdot \max\{\tau \ge 0: \forall x \in u^{-1}(v) \quad \tau \Lambda(x) \le \mathfrak c(x, u(x))\}.$$
Function $t$ depends on $k$, but we omit it in the record.

It is clear that the maximum $\tau$ is zero only if $\mathfrak c(\cdot, v) \equiv 0$, otherwise condition is violated
$(H3)$.
Function $t$ can not be continuous. However, it is easy to see that it is lower semicontinuous.
We now take
$$\tilde{t}(v) := \inf_{w \in u([-1, 1])} \{t(w) + |v - w|\}.$$
It is obvious that $\tilde{t} \le t$, and the set of zeros of $t$ and $\tilde{t}$ coincide.

We show that $\tilde{t}$ is continuous (and even Lipschitz ).
Fix some $v_1$.
Then there is an arbitrarily small $\eps > 0$ and $w_1 \in u([-1, 1])$
satisfying $\tilde{t}(v_1) = t(w_1) + |v_1 - w_1| - \eps$.
For every $v_2$, we have $\tilde{t}(v_2) \le t(w_1) + |v_2 - w_1|$.
And, thus, $\tilde{t}(v_2) - \tilde{t}(v_1) \le |v_1 - v_2| + \eps$.
By the arbitrariness of $v_1$, $v_2$ and $\eps$, we obtain that $\tilde{t}$ is continuous.

When $\alpha \in [0, 1]$ function $\mathfrak d_\alpha(x, v) := \mathfrak c(x, v) + \alpha \Lambda(x) \tilde{t}(v)$
even with respect to $x$, satisfies (\ref{almostConcave}) by Lemma \ref{maxSumConcave}
and does not exceed $\mathfrak a(x, v)$ for construction of the function $\tilde{t}$.
Thus, $\mathfrak d_\alpha$ --- allowable weight.
Further, it is obvious that $\mathfrak d_\alpha$ satisfies $(H1)-(H4)$.

We show that there exists a sequence $\alpha_j \searrow 0$
that $\mathfrak d_{\alpha_j}$ has no horizontal sections, except
Continuum of zeros and a set of measure $0$.
Denote the set of $\alpha$, `` bad '' on the site $[x_i, x_{i + 1}]$:
\begin{multline*}
A_i: = \big \{\alpha \in [ 0, 1 ] \\
meas \{v \in [\min u, \max u]: \frac{\mathfrak c (x_{i + 1}, v) - \mathfrak c (x_i, v))}{\frac{2}{k}} + \alpha \chi_i \tilde{t} (v) = 0 \} > 0 \big \},
\end{multline*}
where $\chi_i = 1$, if $[x_i, x_{i + 1}] \subset [0, 1]$, and $\chi_i = -1$, if $[x_i, x_{i + 1}] \subset [-1, 0]$.

Consider the function
$$
\begin{aligned}
h (v) = & \frac{\mathfrak c (x_{i + 1}, v) - \mathfrak c (x_i, v)}{\tilde{t} (v)} & \text{ if} \tilde{t} ( v) \neq 0 & \\
h (v) = & 0 & \text{ if } \tilde{t} (v) = 0 &.
\end{aligned}
$$
Then $\card(A_i) = \card(\{ \alpha \in [0, 1]: meas \{ v \in [\min u, \max u]: h(v) \pm \frac{2}{k}\\alpha = 0 \} > 0 \}).$
So, $\card(A_i) \le \aleph_0$, and $\card(\cup_i A_i) \le \aleph_0$.
Thus, there is a sequence of weights $\mathfrak d_{\alpha_j} \searrow \mathfrak c$, satisfying $(H1)-(H5)$.
Therefore, $I(\mathfrak d_{\alpha_j}, u^*) \le I(\mathfrak d_{\alpha_j}, u)$.
Passing to the limit, we get $I(\mathfrak c, u^*) \le I(\mathfrak c, u)$.

Further, if $x \in [-1, 1]$ and $k \to \infty$, we have
$$F(u(x), \mathfrak c_k(x, u(x)) |u'(x)|) \to F(u(x), \mathfrak a(x, u(x)) |u'(x)|).$$
Additionally, $F(u(x), \mathfrak a(x, u(x)) |u'(x)|)$ Majorant is integrable.
By the Lebesgue dominated convergence, we get $I(\mathfrak c_k, u) \to I(\mathfrak a, u)$.
Since $I(\mathfrak c_k, u^*) \le I(\mathfrak c_k, u)$, Lemma \ref{uplift} gives (\ref{toprove}).

\bigskip
{\bf Step 5.} Let weight $\mathfrak a$ satisfies only the condition $(H1)$.
Then the inequality (\ref{toprove}).

We will construct an approximation for weights $\mathfrak a$ satisfying $(H1)-(H2)$.
Use Lemma \ref{zeroApprox}.
As the set $W$ we take $\{ v \in \Real: \mathfrak a(\cdot, v) \equiv 0 \}$.
We introduce the notation $$Z_{\mathfrak a}(v) := \{ x \in [-1, 1]: \mathfrak a(x, v) = 0 \}.$$
Note that the sets $Z_{\mathfrak b_k}(v)$ coincide with either $Z_{\mathfrak a}(v)$, either $[-1, 1]$.

We show that $\mathfrak b_k$ satisfies $(H2)$.
Indeed, otherwise there is a sequence $v_l$, for which
$l < \card(Z_{\mathfrak b_k})(v_l) < \infty$.
After passing to a subsequence, we have $v_l \to v_0$.
We show that $Z_{\mathfrak a(v_0)} = [-1, 1]$. Lemma \ref{periodicity} implies that
set $Z_{\mathfrak b_k}(v_l) = Z_{\mathfrak a(v_l)}$ periodic with period of not more than $\frac{2}{l - 1}$.
Take some $x \in [-1, 1]$. For each $l$ $x_l$ exists such that
$\abs{x - x_l} \le \frac{1}{l - 1}$ and $\mathfrak a(x_l, v_l) = 0$.
But $\mathfrak a(x_l, v_l) \to \mathfrak a(x, v_0)$.
Thus, $\mathfrak a(x, v_0) = 0$ and $Z_{\mathfrak a}(v_0) = [-1, 1]$.
But this means that for every $v$ such
that $\abs{v - v_0} \le \frac{1}{k}$, holds $\mathfrak b_k(\cdot, v) \equiv 0$
which contradicts $\card(Z_{\mathfrak b_k})(v_l) < \infty$.


Now we fix $k \in \Nat$, denoted $\mathfrak b_k =: \mathfrak b$
and approximate the function $\mathfrak b$ weights satisfying $(H1)-(H3)$.
From $(H2)$ and Lemma \ref{periodicity}, part 2, it follows that there exists a set $T \subset [-1, 1]$
consisting of a finite number of elements, such that
if $x \not \in T$ and $\mathfrak a(x, v) = 0$ for some $v$, then $\mathfrak b(\cdot, v) \equiv 0$.
Again, we use Lemma \ref{zeroApprox} with multiple
$W = u(T) \cup u^*(T)$.

Obtained with the help of Lemma weight $\mathfrak c_j$ satisfy $(H1)-(H2)$, as distinguished from a $\mathfrak b$
continuous multiplication by a factor less than unity and depends only on $v$.
Obviously, $\min\limits_{dist(x, u^{-1}(v)) \le \frac{2}{j}} \mathfrak c_j(x, v)$ is not equal to zero
$v \in U(\mathfrak c_j)$, starting with some $j$.
Moreover, when $v \in U(\mathfrak c_j)$
$$
\frac{\max\limits_{\abs{x_i - x_{i + 1}} \le \frac{2}{j}} \abs{\mathfrak c_j(x_i, v) - \mathfrak c_j(x_{i + 1}, v)}}
{\min\limits_{\dist(x, u^{-1}(v)) \le \frac{2}{j}} \mathfrak c_j(x, v)}
=\frac{\max\limits_{\abs{x_i - x_{i + 1}} \le \frac{2}{j}} \abs{\mathfrak b(x_i, v) - \mathfrak b(x_{i + 1}, v)}}
{\min\limits_{\dist(x, u^{-1}(v)) \le \frac{2}{j}} \mathfrak b(x, v)}.
$$
In this case, the denominator of the second fraction at $v \in U(\mathfrak c_j)$ bounded away from zero.
Thus, $D_j(\mathfrak c_j, U(\mathfrak c_j))$ is bounded.

Since $D_j$ is not changed by multiplying by a factor of the first argument, which is independent of $x$,
and $U(\mathfrak c_j) \nearrow U(\mathfrak b)$, we have for $j \to \infty$
$$D_j(\mathfrak c_j, U(\mathfrak c_j)) = D_j(\mathfrak b, U(\mathfrak c_j)) \le D_j(\mathfrak b, U(\mathfrak b)) \to 0.$$

Thus, the weights satisfy $\mathfrak c_j$ $(H1)-(H3)$.
Thus, $I(\mathfrak c_j, u^*) \le I(\mathfrak c_j, u)$.
Passing to the limit, we get $I(\mathfrak b_k, u^*) \le I(\mathfrak b_k, u)$, then the inequality (\ref{toprove}).

Thus, Theorem \ref{mainThm} proved.
\hfill $\square$

\medskip

We now consider the case where the function $u$ satisfies the additional condition $u(-1) = 0$.
\begin{thm}
Let $F \in \mathfrak{F}$, the function $u \in \W(-1, 1)$ is nonnegative, $u(-1) = 0$,
weight function $\mathfrak a: [-1, 1] \times \Real_+ \to \Real_+$ continuous
and satisfies $(\ref{almostConcave})$.
Then the inequality $(\ref{toprove})$.
\end{thm}

\begin{proof}
We follow the proof of Theorem \ref{mainThm},
but instead of $(H1)$ and $(H7)$ impose the following conditions on the weight:

\bigskip
\noindent
$(H1')$ $\mathfrak a(x, v)$ satisfies (\ref{almostConcave}), and $I(\mathfrak a, u) < \infty$.

\bigskip
\noindent
$(H7')$ Achieved condition $(H7)$, and $\mathfrak a(\cdot, v) \equiv 0$ in some $v$- neighborhood of zero.

\bigskip
{\bf Step 1.} Let $u \in \W(-1, 1)$, the $u(-1) = 0$ and the weight $\mathfrak a$ satisfies the conditions $(H1'), (H2)-(H6), (H7')$.
Then the inequality (\ref{toprove}).

For proof we approximate the function $u$ in the same way as in the first step of the proof of Theorem \ref{mainThm},
the replacement of $u$ in a neighborhood of $x = -1$ on the linear so that $u_n(-1) = 0$.

\bigskip
{\bf Step 2.} Let weight $\mathfrak a$ satisfies the conditions $(H1'), (H2)-(H6)$.
Then the inequality (\ref{toprove}).

To prove to add to the set $W$ of the second step of the proof of Theorem \ref{mainThm} point $0$
and repeat the argument.

\medskip

Further steps are unchanged.
\end{proof}

