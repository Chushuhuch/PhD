\section{Получение результата в общем случае}

Теперь мы хотим совершить переход от монотонного по $x$ веса к произвольному непрерывному.
Мы будем это делать в несколько промежуточных этапов.

От монотонного по $x$ веса можно перейти к кусочно монотонному.
Более того, нам важна лишь монотонность в некоторой окрестности графика $u(x)$
по оси значений.
То есть достаточно покрыть график прямоугольниками, в каждом из которых вес монотонен по $x$.

Далее, результат можно обобщить на кусочно линейные по $x$ веса.
Чтобы для таких функций можно было выделить прямоугольники,
узлы разбиения должны иметь абсциссу, не зависящую от $u$.

И, наконец, после этого можно получить результат в самом общем виде.

Мы наложим на функцию несколько ограничений, а затем будем от них избавляться,
переходя каждый раз во все более общие условия.

\bigskip

На протяжении всей работы мы накладываем на вес $a$ следующие ограничения:

\smallskip
\noindent
(H1) $a(x, u)$ удовлетворяет неравенству (\ref{almostConcave}),
непрерывна, а также $I(u) < \infty$.
\smallskip

Будем называть такие функции допустимыми.

\bigskip
\noindent
$(H2)$ Количество нулей функций $a(\cdot, u)$ ограничено константой,
не зависящей от $u$ для тех $u \in [\min u(x), \max u(x)]$,
для которых $a(\cdot, u) \not\equiv 0$.

\bigskip
Введем обозначение
$$D_k(a, U) := \sup\limits_{u \in U}
\frac{\max\limits_{ \abs{x_1 - x_2} \le \frac{2}{k} } \abs{a(x_1, u) - a(x_2, u)} }
{\min\limits_{x \in C_k(u)} a(x, u)},$$
где $C_k(u)$ --- $\frac{2}{k}$-окрестность множества $u^{-1}(u)$.
$U(a) := \{ u \in [\min u(x), \max u(x)]: a(\cdot, u) \not \equiv 0 \}$.

\noindent
$(H3)$ Если $a(x_0, u(x_0)) = 0$ для некоторого $x_0$,
то $a(\cdot, u(x_0)) \equiv 0$.
Кроме того, выполнено $D_k(a, U(a)) \to 0$.

\bigskip
\noindent
$(H4)$ Найдется такое четное $k$, что $a(\cdot, u)$ линейны для каждого $u$ на участках
$[-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}]$.

\bigskip
\noindent
$(H5)$ Множество $u \in \Real$, для которых $a(\cdot, u)$ имеет участки постоянства,
отличается от множества $u \in \Real$ таких, что $a(\cdot, u) \equiv 0$,
лишь на множество меры $0$.

\bigskip
\noindent
$(H6)$ $[-1, 1]$ можно разбить на конечное число промежутков,
в $u$-окрестности графика $u(x)$ на каждом из которых вес $a$ имеет одну монотонность по $x$.

\bigskip
\noindent
$(H7)$ Между соседними участками строгого убывания и возрастания веса по $x$ в окрестности графика
найдется точка $(x, u(x))$, в $u$-окрестности которой вес тождественно равен нулю.

\bigskip

Для доказательства нам потребуются следующие факты.

\begin{prop}
\label{levelDerivative}
\cite[стр. 137]{LL}
Для любой $u \in \W(-1, 1)$ и произвольного $A \subset \Real$ меры ноль выполнено
$u'(x) = 0$ для почти всех $x \in [-1, 1] : u(x) \in A$.
\end{prop}

\begin{lm}
\label{zeroApprox}
Предположим, вес $a$ является допустимым и имеется замкнутое множество
$W \subset \Real$ такое, что либо оно содержит счетное число элементов,
либо $a|_{u \in W} \equiv 0$.
Тогда найдется последовательность весов $b_k$ такая, что $I(b_k, u) \to I(a, u)$,
и для любого $u$ в некоторой окрестности $W$ (зависящей от $k$) $b_k(\cdot, u) \equiv 0$,
а также $b_k \nearrow a$ для всех $u$, кроме, возможно, счетного количества.
\end{lm}

\begin{proof}
Возьмем $b_k(x, u) := a(x, u) \min(1, \max(0, k \dist(u, W) - 1)) \le a(x, u)$.
Этот вес равен нулю в $\left(\frac{1}{k}\right)$-окрестности $W$.
В частности, если $W$ не состоит из счетного числа элементов,
$b_k \equiv a \equiv 0$ при $u \in W$.
Кроме того, $b_k \equiv a$ вне $\left(\frac{2}{k}\right)$-окрестности $W$ и
$b_k(x, u)$ возрастают при увеличении $k$.
Тем самым, $b_k \nearrow a$ при всех $u$ кроме, возможно, счетного количества точек.
Отсюда $I(\Real \setminus W, b_k, u) \nearrow I(\Real \setminus W, a, u)$.

Если $W$ не состоит из счетного числа точек,
$I(W, b_k, u) = \int_W F(u(x), 0) dx = I(W, a, u)$.
В противном случае
$W = \{w_i\}_{i = 1}^\infty$ и
$$I(W, b_k, u) = \sum_{i = 1}^\infty \int\limits_{x : u(x) = w_i} F(w_i, b_k(x, w_i) u'(x)) dx.$$
При этом, по утверждению (\ref{levelDerivative}), на каждом из множеств
$\{ x : u(x) = w_i \}$ производная $u'(x)$ почти всюду равна нулю.
То есть,
$I(W, b_k, u) = \sum_{i = 1}^\infty \int\limits_{x : u(x) = w_i} F(w_i, 0) dx = I(W, a, u)$
(такой интеграл не зависит от веса).
\end{proof}

Перейдем к доказательству неравенства (\ref{toprove}).
Для начала, докажем при условии выполнения $(H1)-(H7)$.

Зафиксируем вес $a$ и осуществим предельный переход по $u$.
Будем опираться на наличие неравенства для липшицевых функций $u$,
и получать результат для произвольных $u \in \W[-1, 1]$.
Разобьем отрезок $[-1, 1]$ на отрезки, состоящие из двух частей.
В левой части каждого отрезка вес $a$ будет убывать по $x$ в окрестности
графика $u(x)$. В правой же будет возрастать.

Исходя из $(H7)$ на каждом отрезке найдется $x_0$, в некоторой окрестности
$[x^-, x^+]$ которого значение функционала не будет зависеть от значений функции $u$
(если не менять ее очень сильно).

Тогда на каждом отрезке $[x_1, x_2]$ в качестве $u_n(x)$ возьмем
аппроксимацию липшицевыми функциями с закрепленным левым концом на отрезке $[x_1, x^-]$,
аппроксимацию липшицевыми функциями с закрепленным правым концом на отрезке $[x^+, x_2]$,
и на $[x^-, x^+]$ зададим ее линейно.

В начале отрезка $[-1, 1]$ может остаться участок, на котором вес $a$ возрастает в окрестности графика $u$.
Аналогично, в его конце может остаться участок убывания.
На этих участках возьмем в качестве $u_n$ соответствующее приближение липшицевыми функциями.

Тем самым, мы получим $u_n \to u$ в $\W(-1, 1)$ и $I(u_n) \to I(u)$.

\bigskip

Избавимся от $(H7)$.

Применим лемму \ref{zeroApprox}. В качестве множества $W$ возьмем множество
всех $u$, при которых происходит переход графика $u(x)$ из прямоугольника,
в котором вес убывает по $x$ в прямоугольник, в котором вес возрастает.
Очевидно, получившиеся $b_k$ удовлетворяют $(H7)$.
\bigskip

Избавимся от $(H6)$.

Прямоугольник $[-1, 1] \times [\min u(x), \max u(x)]$ естественным образом
делится абсциссами излома веса $a$ и участками постоянства $a$ по $x$ на прямоугольники,
в которых вес $a$ имеет постоянную монотонность по $x$.
Однако, таких прямоугольников может оказаться бесконечное количество.
Кроме того, если функция пересекает горизонтальную границу прямоугольника,
монотонность в $u$-окрестности точки пересечения может меняться.

Возьмем множество $u$, для которых вес имеет участки постоянства по $x$,
в качестве $W$.
В соответствии с $(H5)$ множество $W$ имеет меру $0$.
Применим к нему лемму \ref{zeroApprox}.
Предположим теперь, что какая-то из $b_k$, полученных в результате
применения леммы, не удовлетворяет $(H6)$.
Это значит, что найдется сколь угодно малый интервал $(u_1, u_2)$,
на котором нельзя покрыть график $u(x)$ прямоугольниками с одинаковой
монотонностью веса по $x$.
Но этот интервал также должен пересекаться с $W$, а тогда, при
достаточно малой величине $u_2 - u_1$, $a(x, u) = 0$ при $u \in [u_1, u_2]$,
что противоречит предположению.

\bigskip
Избавимся от $(H4)$ и $(H5)$.

Предположим, функция $a$ удовлетворяет $(H1)$--$(H3)$, в том числе $I(u) < \infty$.
Сначала приблизим ее снизу кусочно линейными.
Поскольку приближающие кусочно линейные функции
по построению будут строго меньше $a$ (кроме нулей), можно пользоваться тем, что
$I(u^*) < \infty$ для таких весов.
И, тем самым, для второго перехода можно пользоваться теоремой о мажорированной сходимости.

Зафиксируем некоторое $k$.
По точкам $a(-1 + \frac{2i}{k}, u)$ для каждого $u$ построим кусочно линейную функцию.
Получившаяся функция $a_k(x, u)$ непрерывна и,
по лемме \ref{piecewiseLinearConcave}, удовлетворяет неравенству
(\ref{almostConcave}).

Возьмем $c_k := (1 - D_k(a_k, U(a_k))) a_k$.
$D_k(a_k, U(a_k))$ положителен и стремится к $0$, поэтому $c_k \to a$.
Покажем, что $c_k \le a$.
Возьмем некоторый
$x \in [-1 + \frac{2i}{k}, -1 + \frac{2(i + 1)}{k}] =: [x_1, x_2]$.
Тогда $c_k(x, u(x)) \le \max( c_k(x_1, u(x)), c_k(x_2, u(x)) )$, поскольку
$c_k$ кусочно линейны по $x$. Далее,
$c_k(x_1, u(x)) = (1 - D_k(a_k, U(a_k))) a(x_1, u(x)) \le
a(x_1, u(x)) - \frac{a(x_1, u(x)) - a(x, u(x))}{a(x_1, u(x))} a(x_1, u(x)) = a(x, u(x))$.
Аналогично $c_k(x_2, u) \le a(x, u(x))$.
Тем самым, $c_k(x, u(x)) \le a(x, u(x))$ для любого $x$, и $c_k$ являются допустимыми.

$F(u(x), c_k(x, u(x)) u'(x)) \to F(u(x), a(x, u(x)) u'(x))$ для любой функции $u$.
Кроме того, $F(u(x), a(x, u(x)) u'(x))$ является суммируемой мажорантой.
По теореме Лебега о мажорируемой сходимости, получаем $I(c_k, u) \to I(a, u)$
и $I(c_k, u^*) \to I(a, u^*)$.
Функции $c_k$ удовлетворяют $(H1)$--$(H4)$.

Обозначим некоторую $c_k=:c$ и будем приближать ее весами, удовлетворяющими $(H1)$--$(H5)$.
Рассмотрим функцию $\Lambda(x) = \frac{k}{2} (1 - \abs{x})$,
она удовлетворяет условию (\ref{almostConcave}).
Найдется такая функция $t(u) \ge 0$ такая, что $t(u) = 0$ равносильно $c(\cdot, u) \equiv 0$, и
$c(x, u) + \Lambda(x) t(u)$ удовлетворяет условиям $(H1)$--$(H4)$.

А именно: возьмем в качестве $t(u):=D_k(a_k, U(a_k)) \max\{\tau \ge 0: \forall x \in [-1, 1] \tau \Lambda(x) \le a_k(x, u(x))\}$.
Ясно, что максимальное $\tau$ равно нулю только если $a_k(\cdot, u) \equiv 0$, иначе нарушается условие
$(H3)$.
$t$ непрерывна, потому что веса кусочно линейные.

Тогда для каждого $\alpha \le 1$ функция $a(x, u) + \alpha \Lambda(x) t(u)$
тоже удовлетворяет условиям $(H1)$--$(H4)$.

Покажем, что в окрестности $0$ найдется достаточное количество $\alpha$ таких,
что $a(x, u) + \alpha \Lambda(x) t(u)$ не имеет горизонтальных участков, кроме
сплошных нулей и множества меры $0$.
Обозначим множество $\alpha$, неподходящих на участке $[x_i, x_{i + 1}]$
$$A_i := \{ \alpha \in [0, 1]: \abs{ \{ u \in [\min u, \max u]: a(x_{i + 1}, u) - a(x_i, u)) + \alpha t(u) = 0 \} } > 0 \}.$$
Рассмотрим функцию $h(u) = \frac{a(x_{i + 1}, u) - a(x_i, u)}{t(u)}$ при $t(u) \neq 0$ и $h(u) = 0$ при $t(u) = 0$.
Тогда $\#A_i = \#\{ \alpha \in [0, 1]: \abs{ \{ u \in [\min u, \max u]: h(u) + \alpha = 0 \} } > 0 \} (-1).$
(Во втором множестве может появиться лишний $0$.)
Значит, $\#A_i \le \aleph_0$, а также $\#\cup A_i \le \aleph_0$.
Тем самым, найдется последовательность допустимых функций $a(x, u) + \alpha_j \Lambda(x) t(u)$,
удовлетворяющих $(H1)$--$(H5)$ и сходящихся к $a(x, u)$.

\bigskip
Избавимся от $(H3)$.

Возьмем вес $a$, удовлетворяющий $(H1)$--$(H2)$.
Из $(H2)$ следует, что найдется множество $T \subset [-1, 1]$,
состоящее из конечного числа элементов, такое, что
если $x \not \in T$ и $a(x, u) = 0$ для некоторого $u$, то $a(\cdot, u) \equiv 0$.
Вновь воспользуемся леммой (\ref{zeroApprox}) с множеством
$W = u(T) \cup u^*(T)$.

Полученные веса удовлетворяют $(H1)$--$(H2)$, поскольку отличаются от $a$ лишь
домножением на непрерывный множитель меньший единицы и зависящий только от $u$.
Кроме того, $\min\limits_{x \in C_k(u)} a(x, u)$ не равен нулю на множестве
$U(b_k)$ начиная с некоторого $k$, значит $D_k(b_k, U(b_k)) = D_k(a, U(b_k)) \to 0$.

\bigskip
Избавимся от $(H2)$.

Предположим, вес $a$ является допустимым.
Будем строить приближение для него весами, удовлетворяющими $(H1)$--$(H2)$.
Воспользуемся леммой \ref{zeroApprox}.
В качестве множества $W$ возьмем $\{ u \in \Real: a(\cdot, u) \equiv 0 \}$.
Введем обозначение $Z_a(u) := \{ x \in [-1, 1]: a(x, u) = 0 \}$.
Заметим, что множества $Z_{b_k}(u)$ отличаются от $Z_a(u)$ лишь сменой для
некоторых $u$ на весь отрезок $[-1, 1]$.
Нам остается доказать, что полученные $b_k$ удовлетворяют $(H2)$,
то есть найдется число $p$ такое, что для каждого $u$ множество
$Z_{b_k}(u)$ либо совпадает с отрезком $[-1, 1]$, либо $\#Z_{b_k}(u) \le p$.

Предположим, это не так, и найдется последовательность $u_l$, для которой
$l < \#Z_{b_k}(u_l) < \infty$.
Тогда, после перехода к подпоследовательности, она будет стремиться к некоторому
$u_0$. Более того, $Z_{b_k}(u_l) = Z_a(u_l)$, поскольку $Z_{b_k}(u_l) \neq [-1, 1]$.
Покажем, что $Z_a(u_0) = [-1, 1]$. Из леммы \ref{periodicity} следует, что
множества $Z_a(u_l)$ периодические с периодом не более $\frac{2}{l - 1}$.
Возьмем некоторый $x \in [-1, 1]$. Для каждого $l$ найдется $x_l$ такой, что
$\abs{x - x_l} \le \frac{1}{l - 1}$ и $a(x_l, u_l) = 0$.
Но $a(x_l, u_l) \to a(x, u_0)$.
Тем самым, $a(x, u_0) = 0$ и $Z_a(u_0) = [-1, 1]$.
Но это означает, что для каждого $u$ такого,
что $\abs{u - u_0} \le \frac{1}{k}$, выполнено $b_k(\cdot, u) \equiv 0$,
что противоречит $\#Z_{b_k}(u_l) < \infty$.

Тем самым, неравенство (\ref{toprove}) доказано для всех допустимых весов.